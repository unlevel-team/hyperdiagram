/*! For license information please see hyperengine-Lib.js.LICENSE.txt */
window.HyperEngine=(()=>{"use strict";var e={405:(e,t,n)=>{n.r(t),n.d(t,{diagram:()=>ve,engine:()=>me});const r={generateID:({otherIDs:e})=>{let t=null;do{t=r.makeid(11)}while(void 0!==e[t]);return t},makeid:e=>{for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,o=0;o<e;o++)t+=n.charAt(Math.floor(Math.random()*r));return t}},o=r,s={connectionsALL:{},connections:{}},i={createConnection:({type:e,source:t,target:n})=>{if(i.getConnections({source:t,target:n}).length>0)return null;const r={id:o.generateID({otherIDs:s.connectionsALL}),type:e,source:t,target:n};return s.connectionsALL[r.id]=r,s.connections[r.id]=r,r},addConnection:({connection:e})=>{s.connectionsALL[e.id]=e,s.connections[e.id]=e},getConnection:({id:e=null})=>null!==e&&s.connections[e]||null,getConnections:({source:e=null,target:t=null})=>null!==e&&null===t?Object.values(s.connections).filter((t=>t.source===e)):null!==t&&null===e?Object.values(s.connections).filter((e=>e.target===t)):null!==e&&null!==t?Object.values(s.connections).filter((n=>n.source===e&&n.target===t)):[],getAllConnections:()=>s.connectionsALL,deleteConnection:({id:e})=>void 0===s.connections[e]?null:(delete s.connections[e],delete s.connectionsALL[e],!0),clearAllConnections:()=>{Object.keys(s.connectionsALL).forEach((e=>{i.deleteConnection({id:e})}))}},a=i,c={FLOW:{STEP_START:"step-start",STEP_END:"step-end"},DATA:{DATA_IN:"data-in",DATA_OUT:"data-out"}},d={connectorsALL:{},connectors:{}},l={TYPES:c,_env:d,addConnector:({node:e,type:t,position:n=0})=>{const{connectorsALL:r}=l._env,s={id:null,type:t,position:n,node:e};switch(t){case c.FLOW.STEP_START:s.id=o.generateID({otherIDs:r}),e.connectors.flow[s.id]=s;break;case c.FLOW.STEP_END:s.id=o.generateID({otherIDs:r}),l._checkConnectorPosition({connectors:l.getConnectors({node:e,type:t}),position:n}),e.connectors.flow[s.id]=s;break;case c.DATA.DATA_IN:case c.DATA.DATA_OUT:s.id=o.generateID({otherIDs:r}),e.connectors.data[s.id]=s}return null!==s.id&&(d.connectorsALL[s.id]=s,d.connectors[s.id]=s),s.id},getConnector:({id:e})=>d.connectors[e],getConnectorDATA:({id:e})=>{const{node:t,...n}=d.connectorsALL[e];return n},getConnectors:({node:e=null,type:t=null})=>{const{connectors:n}=d;let r=[];return null!==e&&null===t?r=Object.values(n).filter((t=>t.node.id===e.id)):null!==t&&null===e?r=Object.values(n).filter((e=>e.type===t)):null!==e&&null!==t&&(r=Object.values(n).filter((n=>n.node.id===e.id&&n.type===t))),r},deleteConnector:({node:e,type:t,id:n})=>{let r=!1;switch(t){case c.FLOW.STEP_START:void 0!==e.connectors.flow[n]&&(delete e.connectors.flow[n],r=!0);break;case c.FLOW.STEP_END:void 0!==e.connectors.flow[n]&&(l._deleteConnectorByPosition({connectors:Object.values(e.connectors.flow).filter((e=>e.type===c.FLOW.STEP_END)),position:e.connectors.flow[n].position}),delete e.connectors.flow[n],r=!0);break;case c.DATA.DATA_IN:case c.DATA.DATA_OUT:void 0!==e.connectors.data[n]&&(delete e.connectors.data[n],r=!0)}return a.getConnections({source:n}).forEach((e=>a.deleteConnection({id:e.id}))),a.getConnections({target:n}).forEach((e=>a.deleteConnection({id:e.id}))),!0===r&&(delete d.connectorsALL[n],delete d.connectors[n]),r},_checkConnectorPosition:({connectors:e,position:t})=>{const n=Array.isArray(e)?e:Object.values(e);n.length<t&&(t=n.length),n.sort(((e,t)=>e.position>t.position?1:e.position<t.position?-1:0));for(let e=t;e<n.length;e++)n[e].position++},_deleteConnectorByPosition:({connectors:e,position:t})=>{const n=Object.values(e);if(n.length<t)throw Error("Bad position");n.sort(((e,t)=>e.position>t.position?1:e.position<t.position?-1:0));for(let e=t+1;e<n.length;e++)n[e].position--},loadConnectors:({node:e})=>{Object.values(e.connectors.flow).forEach((t=>{t.node=e,d.connectors[t.id]=t,d.connectorsALL[t.id]=t})),Object.values(e.connectors.data).forEach((t=>{t.node=e,d.connectors[t.id]=t,d.connectorsALL[t.id]=t}))}},u=l,f={id:null,name:null,description:null,properties:{}},p={id:null,reference:null},h={states:{},referencesALL:{},references:{}},g={_env:h,addState:({id:e,name:t,description:n,properties:r})=>{if(void 0!==h.states[e])throw new Error("State id already exists");const o={...f,id:e,name:t,description:n,properties:r};h.states[e]=o},getStates:()=>h.states,getState:({id:e})=>h.states[e],updateState:({id:e,name:t,description:n,properties:r})=>{if(void 0===h.states[e])throw new Error("State id not exists");const o={...f,id:e,name:t,description:n,properties:r};h.states[e]=o},deleteState:({id:e})=>void 0===h.states[e]?null:(Object.values(h.references).filter((t=>t.reference===e)).forEach((e=>{g.deleteReference({id:e.id})})),delete h.states[e],!0),clearStates:()=>{Object.values(h.states).forEach((e=>g.deleteState(e)))},addReference:({id:e=null,state:t})=>{if(void 0===h.states[t])throw new Error("State id not exists");if(void 0!==h.referencesALL[e])throw new Error("State reference id already exists");const n={...p,id:e,reference:t};return h.referencesALL[e]=n,h.references[e]=n,n},getReferences:()=>h.references,getAllReferences:()=>h.referencesALL,getReference:({id:e})=>h.references[e],getStateReferences:({id:e})=>Object.values(h.references).filter((t=>t.reference===e)),deleteReference:({id:e})=>void 0===h.references[e]?null:(delete h.references[e],delete h.referencesALL[e],!0)},y=g,b={nodesDEFS:{flow_step_default:{def:{name:"flow step default",category:"flow",family:"step",type:"default",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}]},create:({node:e})=>e,delete:({node:e})=>{}},data_state_default:{def:{name:"data state default",category:"data",family:"state",type:"default",connectors:[{type:"data-in"},{type:"data-out"}]},create:({node:e})=>{null===e.extra&&(e.extra={}),e.extra={source:null,state:null,reference:null,...e.extra};const t=y.getState({id:e.extra.source});e.extra.state=t;const n=y.addReference({id:e.id,state:e.extra.source});return e.extra.reference=n.id,e},delete:({node:e})=>{y.deleteReference({id:e.extra.reference})},getDATA:({node:e})=>({...e,extra:{...e.extra,state:null}})},flow_step_pause:{def:{name:"flow step pause",category:"flow",family:"step",type:"pause",connectors:[{type:"step-start"},{type:"step-end"}]},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t})=>{t.flowControl.pauseFlow()}}},flow_step_function_call:{def:{name:"flow step function call",category:"flow",family:"step",type:"function-call",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}],attributes:{"function-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t,data:n})=>{t.diagramProcess.getExternalProcess({id:e.extra.attributes["function-name"].value})({engine:t,data:n})}}},flow_signal_listen:{def:{name:"flow signal listen",category:"flow",family:"signal",type:"listen",connectors:[{type:"step-end"}],attributes:{"signal-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{processDiagram:({diagram:e,engine:t})=>{const n=e.node.getNodes();let r=[];Object.values(n).filter((e=>"flow"===e.category&&"signal"===e.family&&"listen"===e.type)).forEach((e=>{const n=e.extra.attributes["signal-name"].value;r.includes(n)||(r.push(n),t.flowSignals.listenToSignal({signal:n,listener:()=>{t.flowControl.gotoNode({id:e.id})}}))}))}}},flow_signal_emit:{def:{name:"flow signal emit",category:"flow",family:"signal",type:"emit",connectors:[{type:"step-start"}],attributes:{"signal-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t})=>{t.flowSignals.notifySignal({signal:e.extra.attributes["signal-name"].value})}}}},categories:{}},v={_env:b,init:()=>{Object.keys(b.nodesDEFS).forEach((e=>{v.defineNode({nodeDEF:b.nodesDEFS[e]})}))},defineNode:({nodeDEF:e})=>{const{category:t,family:n,type:r}=e.def;void 0===b.categories[t]&&(b.categories[t]={name:t,families:{}});const o=b.categories[t];void 0===o.families[n]&&(o.families[n]={name:n,types:{}});const s=o.families[n];if(void 0!==s.types[r])throw new Error("Node type already defined");s.types[r]={name:r,def:e}},getNodeDEF:({category:e,family:t,type:n})=>{const r=b.categories[e];if(void 0===r)throw new Error("Category not found.");const o=r.families[t];if(void 0===o)throw new Error("Family not found.");const s=o.types[n];if(void 0===s)throw new Error("Type not found.");return s.def},getAllNodeDEFS:()=>b.nodesDEFS},m=v;var w=n(449),E=n.n(w);const A=e=>E()({proto:!0})(e),_={nodesALL:{},nodes:{}},S={_env:_,init:()=>{m.init()},create:({category:e,family:t,type:n,extra:r={}})=>{const s=m.getNodeDEF({category:e,family:t,type:n});let i={id:o.generateID({otherIDs:_.nodesALL}),class:"node",category:e,family:t,type:n,name:null,extra:{...r,attributes:{...A(s.def.attributes),...r.attributes}},connectors:{flow:{},data:{}}};return i.name=`${s.def.name} - ${i.id}`,void 0!==s.def.connectors.find((e=>"step-start"===e.type))&&u.addConnector({node:i,type:u.TYPES.FLOW.STEP_START}),void 0!==s.def.connectors.find((e=>"step-end"===e.type))&&u.addConnector({node:i,type:u.TYPES.FLOW.STEP_END}),void 0!==s.def.connectors.find((e=>"data-in"===e.type))&&u.addConnector({node:i,type:u.TYPES.DATA.DATA_IN}),void 0!==s.def.connectors.find((e=>"data-out"===e.type))&&u.addConnector({node:i,type:u.TYPES.DATA.DATA_OUT}),i=s.create({node:i}),_.nodesALL[i.id]=i,_.nodes[i.id]=i,i},delete:({id:e})=>{if(void 0===_.nodes[e])return null;const t=_.nodes[e];return m.getNodeDEF(t).delete({node:t}),u.getConnectors({node:t}).forEach((e=>u.deleteConnector({node:t,type:e.type,id:e.id}))),delete _.nodes[e],delete _.nodesALL[e],!0},getNode:({id:e})=>_.nodes[e],getNodeDEF:m.getNodeDEF,getAllNodeDEFS:m.getAllNodeDEFS,getNodeDATA:({id:e})=>{const t=_.nodes[e];let n={...t,connectors:{flow:{},data:{}}};Object.values(t.connectors.flow).forEach((e=>{n.connectors.flow[e.id]=u.getConnectorDATA(e)})),Object.values(t.connectors.data).forEach((e=>{n.connectors.data[e.id]=u.getConnectorDATA(e)}));const r=m.getNodeDEF(t);return void 0!==r.getDATA&&(n=r.getDATA({node:n})),n},getNodes:()=>_.nodes,getAllNodes:()=>_.nodesALL,getAllNodesDATA:()=>{const e={};return Object.values(_.nodesALL).forEach((t=>{e[t.id]=S.getNodeDATA(t)})),e},clearAllNodes:()=>{Object.keys(_.nodesALL).forEach((e=>{S.delete({id:e})}))},loadNode:({nodeDATA:e})=>{const t=m.getNodeDEF(e);let n={...e};u.loadConnectors({node:n}),n=t.create({node:n}),_.nodesALL[n.id]=n,_.nodes[n.id]=n}},D=S,O={states:y},T={node:D,connectors:u,connection:a,data:O,init:()=>{D.init()},getDATA:()=>{const e={nodes:D.getAllNodesDATA(),connections:a.getAllConnections(),data:{states:O.states.getStates(),references:O.states.getAllReferences()}};return JSON.stringify(e,null,2)},loadDATA:({data:e})=>{D.clearAllNodes(),y.clearStates(),Object.values(e.data.states).forEach((e=>O.states.addState(e))),Object.values(e.nodes).forEach((e=>D.loadNode({nodeDATA:e}))),Object.values(e.connections).forEach((e=>a.addConnection({connection:e})))}},x={engine:null,diagram:null,externalProcesses:{}};class P{constructor(e){this._env={engine:e,diagram:e.hyperdiagram,externalProcesses:{}}}process(){const{diagram:e,engine:t}=this._env,n=e.node.getAllNodeDEFS();Object.values(n).forEach((n=>{const{process:r}=n;void 0!==r&&void 0!==r.processDiagram&&r.processDiagram({diagram:e,engine:t})}))}addExternalProcess({id:e,process:t}){this._env.externalProcesses[e]=t}getExternalProcess({id:e}){return this._env.externalProcesses[e]}clearExternalProcesses(){const{externalProcesses:e}=this._env;Object.keys(e).forEach((t=>{delete e[t]}))}get info(){return j.infoDiagramProcess(this._env.diagram)}}const j={init:({engine:e})=>{x.engine=e,x.diagram=e._env.hyperdiagram},processDiagram:(e=x.diagram)=>{const t=e.node.getAllNodeDEFS();Object.values(t).forEach((e=>{void 0!==e.process&&void 0!==e.process.processDiagram&&e.process.processDiagram({diagram:x.diagram,engine:x.engine})}))},addExternalProcess:({id:e,process:t})=>{x.externalProcesses[e]=t},getExternalProcess:({id:e})=>x.externalProcesses[e],clearExternalProcesses:()=>{Object.keys(x.externalProcesses).forEach((e=>{delete x.externalProcesses[e]}))},infoDiagramProcess:(e=x.diagram)=>{const t=new Set;return Object.values(e.node.getNodes()).filter((e=>"flow"===e.category&&"step"===e.family&&"function-call"===e.type)).forEach((e=>t.add(e.extra.attributes["function-name"].value))),{external:Array.from(t)||[]}},createDiagramProcess:(...e)=>new P(...e)},N=j;var C=function(e,t){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function L(e,t){function n(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function F(e){return"function"==typeof e}var I=!1,U={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,I=e},get useDeprecatedSynchronousErrorHandling(){return I}};function k(e){setTimeout((function(){throw e}),0)}var R={closed:!0,next:function(e){},error:function(e){if(U.useDeprecatedSynchronousErrorHandling)throw e;k(e)},complete:function(){}},H=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}(),B=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),M=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n,r=this,o=r._parentOrParents,s=r._ctorUnsubscribe,i=r._unsubscribe,a=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var c=0;c<o.length;++c)o[c].remove(this);if(F(i)){s&&(this._unsubscribe=void 0);try{i.call(this)}catch(e){t=e instanceof B?V(e.errors):[e]}}if(H(a)){c=-1;for(var d=a.length;++c<d;){var l=a[c];if(null!==(n=l)&&"object"==typeof n)try{l.unsubscribe()}catch(e){t=t||[],e instanceof B?t=t.concat(V(e.errors)):t.push(e)}}}if(t)throw new B(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=n._parentOrParents;if(null===o)n._parentOrParents=this;else if(o instanceof e){if(o===this)return n;n._parentOrParents=[o,this]}else{if(-1!==o.indexOf(this))return n;o.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function V(e){return e.reduce((function(e,t){return e.concat(t instanceof B?t.errors:t)}),[])}var Y=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),W=function(e){function t(n,r,o){var s=e.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=R;break;case 1:if(!n){s.destination=R;break}if("object"==typeof n){n instanceof t?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new q(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new q(s,n,r,o)}return s}return L(t,e),t.prototype[Y]=function(){return this},t.create=function(e,n,r){var o=new t(e,n,r);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(M),q=function(e){function t(t,n,r,o){var s,i=e.call(this)||this;i._parentSubscriber=t;var a=i;return F(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==R&&(F((a=Object.create(n)).unsubscribe)&&i.add(a.unsubscribe.bind(a)),a.unsubscribe=i.unsubscribe.bind(i))),i._context=a,i._next=s,i._error=r,i._complete=o,i}return L(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;U.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=U.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):k(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;k(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};U.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),U.useDeprecatedSynchronousErrorHandling)throw e;k(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!U.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return U.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(k(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(W),z=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function J(e){return e}function $(e){return 0===e.length?J:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var G=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,o=function(e,t,n){if(e){if(e instanceof W)return e;if(e[Y])return e[Y]()}return e||t||n?new W(e,t,n):new W(R)}(e,t,n);if(r?o.add(r.call(o,this.source)):o.add(this.source||U.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),U.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){U.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,o=t.isStopped;if(n||o)return!1;e=r&&r instanceof W?r:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=K(t))((function(t,r){var o;o=n.subscribe((function(t){try{e(t)}catch(e){r(e),o&&o.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[z]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:$(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=K(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function K(e){if(e||(e=U.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var Q=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),X=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return L(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(M),Z=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return L(t,e),t}(W),ee=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return L(t,e),t.prototype[Y]=function(){return new Z(this)},t.prototype.lift=function(e){var t=new te(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Q;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].next(e)},t.prototype.error=function(e){if(this.closed)throw new Q;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),o=0;o<n;o++)r[o].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Q;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Q;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Q;return this.hasError?(e.error(this.thrownError),M.EMPTY):this.isStopped?(e.complete(),M.EMPTY):(this.observers.push(e),new X(this,e))},t.prototype.asObservable=function(){var e=new G;return e.source=this,e},t.create=function(e,t){return new te(e,t)},t}(G),te=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return L(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):M.EMPTY},t}(ee);const ne={subject:new ee,listeners:{}};class re{constructor(){this._env={subject:new ee,listeners:{}}}notifySignal({signal:e}){const{subject:t}=this._env;t.next({signal:e})}listenToSignal({listener:e,signal:t}){const{_env:n}=this,{subject:r,listeners:o}=n;void 0===o[t]&&(o[t]=[]);const s=r.subscribe({next:n=>{n.signal===t&&e(n)}});return o[t].push({listener:e,subscriber:s}),s}clearSignals(){const{listeners:e}=this._env;Object.keys(e).forEach((t=>{e[t].forEach((e=>e.subscriber.unsubscribe())),delete e[t]}))}}const oe={notifySignal:({signal:e})=>{const{subject:t}=ne;t.next({signal:e})},listenToSignal:({listener:e,signal:t})=>{const{subject:n}=ne;void 0===ne.listeners[t]&&(ne.listeners[t]=[]);const r=n.subscribe({next:n=>{n.signal===t&&e(n)}});return ne.listeners[t].push({listener:e,subscriber:r}),r},clearSignals:()=>{Object.keys(ne.listeners).forEach((e=>{ne.listeners[e].forEach((e=>e.subscriber.unsubscribe())),delete ne.listeners[e]}))},infoDiagramSignals:({diagram:e})=>{const t=new Set,n=new Set;return Object.values(e.node.getNodes()).filter((e=>"flow"===e.category&&"signal"===e.family)).forEach((e=>{switch(e.type){case"listen":t.add(e.extra.attributes["signal-name"].value);break;case"emit":n.add(e.extra.attributes["signal-name"].value)}})),{listen:Array.from(t)||[],emit:Array.from(n)||[]}},createFlowSignals:(...e)=>new re(...e)},se={engine:null,hyperdiagram:null,nextNode:null,onPause:!1,runningNode:!1};class ie{constructor(e){this._env={engine:e,hyperdiagram:e.hyperdiagram,nextNode:null,onPause:!1,runningNode:!1}}gotoNode(e){const{_env:t}=this,{engine:n,hyperdiagram:r}=t,o=r.node.getNode({id:e}),s=r.node.getNodeDEF(o);t.runningNode=!0,t.onPause=!1,t.nextNode=null,n.dataControl.setDataFromNode({node:o});const i=n.dataControl.getDATA();s.process&&s.process.run&&s.process.run({node:o,engine:n,data:i});const a=Object.values(o.connectors.flow).filter((e=>"step-end"===e.type))[0];if(void 0!==a){const e=r.connection.getConnections({source:a.id})[0];if(void 0!==e){const n=r.connectors.getConnector({id:e.target});t.nextNode=n.node.id}}t.runningNode=!1,requestAnimationFrame((()=>ae.nextStep()))}nextStep(){const{_env:e}=this;e.onPause||null!==e.nextNode&&this.gotoNode(e.nextNode)}pauseFlow(){this._env.onPause=!0}get isOnPause(){return this._env.onPause}}const ae={init:({engine:e})=>{se.engine=e,se.hyperdiagram=e._env.hyperdiagram},gotoNode:({id:e})=>{const t=se.hyperdiagram.node.getNode({id:e}),n=se.hyperdiagram.node.getNodeDEF(t);se.runningNode=!0,se.onPause=!1,se.nextNode=null,se.engine.dataControl.setDataFromNode({node:t});const r=se.engine.dataControl.getDATA();n.process&&n.process.run&&n.process.run({node:t,engine:se.engine,data:r});const o=Object.values(t.connectors.flow).filter((e=>"step-end"===e.type))[0];if(void 0!==o){const e=se.hyperdiagram.connection.getConnections({source:o.id})[0];if(void 0!==e){const t=se.hyperdiagram.connectors.getConnector({id:e.target});se.nextNode=t.node.id}}se.runningNode=!1,requestAnimationFrame((()=>ae.nextStep()))},nextStep:()=>{se.onPause||null!==se.nextNode&&ae.gotoNode({id:se.nextNode})},pauseFlow:()=>{se.onPause=!0},createFlowControl:(...e)=>new ie(...e)},ce=ae,de={engine:null,hyperdiagram:null,dataIN:{},dataOUT:{}};class le{constructor(e){this._env={engine:e,hyperdiagram:e.hyperdiagram,dataIN:{},dataOUT:{}}}setDataFromNode(e){const{_env:t}=this,{hyperdiagram:n}=t;t.dataIN={},t.dataOUT={};const r=n.connectors.getConnectors({node:e,type:"data-in"})[0];void 0!==r&&n.connection.getConnections({target:r.id}).forEach((e=>{const r=n.connectors.getConnector({id:e.source}),o=n.data.states.getState({id:r.node.extra.source});t.dataIN[o.id]=Object.values(o.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}));const o=n.connectors.getConnectors({node:e,type:"data-out"})[0];void 0!==o&&n.connection.getConnections({source:o.id}).forEach((e=>{const r=n.connectors.getConnector({id:e.target}),o=n.data.states.getState({id:r.node.extra.source});t.dataOUT[o.id]=Object.values(o.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}))}get data(){const{_env:e}=this;return{dataIN:e.dataIN,dataOUT:e.dataOUT}}get info(){return ue.infoDiagramDATA(this._env.hyperdiagram)}clearDATA(){const{_env:e}=this;e.dataIN={},e.dataOUT={}}updateOutputDATA(){const{_env:e}=this;Object.keys(e.dataOUT).forEach((t=>{const n=e.hyperdiagram.data.states.getState({id:t});Object.keys(e.dataOUT[t]).forEach((r=>{n.properties[r].value=e.dataOUT[t][r]}))}))}}const ue={init:({engine:e})=>{de.engine=e,de.hyperdiagram=e._env.hyperdiagram},setDataFromNode:({node:e})=>{de.dataIN={},de.dataOUT={};const t=de.hyperdiagram.connectors.getConnectors({node:e,type:"data-in"})[0];void 0!==t&&de.hyperdiagram.connection.getConnections({target:t.id}).forEach((e=>{const t=de.hyperdiagram.connectors.getConnector({id:e.source}),n=de.hyperdiagram.data.states.getState({id:t.node.extra.source});de.dataIN[n.id]=Object.values(n.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}));const n=de.hyperdiagram.connectors.getConnectors({node:e,type:"data-out"})[0];void 0!==n&&de.hyperdiagram.connection.getConnections({source:n.id}).forEach((e=>{const t=de.hyperdiagram.connectors.getConnector({id:e.target}),n=de.hyperdiagram.data.states.getState({id:t.node.extra.source});de.dataOUT[n.id]=Object.values(n.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}))},getDATA:()=>({dataIN:de.dataIN,dataOUT:de.dataOUT}),clearDATA:()=>{de.dataIN={},de.dataOUT={}},updateOutputDATA:()=>{Object.keys(de.dataOUT).forEach((e=>{const t=de.hyperdiagram.data.states.getState({id:e});Object.keys(de.dataOUT[e]).forEach((n=>{t.properties[n].value=de.dataOUT[e][n]}))}))},infoDiagramDATA:(e=de.hyperdiagram)=>{const t=new Set;return Object.values(e.node.getNodes()).filter((e=>"data"===e.category&&"state"===e.family&&"default"===e.type)).forEach((e=>{t.add(e.extra.source)})),Array.from(t).reduce(((t,n)=>{t[n]={};const r=e.data.states.getState({id:n});return Object.keys(r.properties).forEach((e=>{t[n][e]=r.properties[e].value})),t}),{})},createDataControl:(...e)=>new le(...e)},fe=ue,pe={hyperdiagram:null};class he{constructor(e){this._env={hyperdiagram:e},this.diagramProcess=N.createDiagramProcess(this),this.flowSignals=oe.createFlowSignals(),this.flowControl=ce.createFlowControl(this),this.dataControl=fe.createDataControl(this)}get hyperdiagram(){return this._env.hyperdiagram}clearEngine(){const{dataControl:e,flowSignals:t,diagramProcess:n}=this;e.clearDATA(),t.clearSignals(),n.clearExternalProcesses()}get diagramInfo(){const{dataControl:e,diagramProcess:t,hyperdiagram:n}=this;return{process:t.info(),signals:oe.infoDiagramSignals({diagram:n}),data:e.info()}}}const ge={_env:pe,init:({hyperdiagram:e})=>{pe.hyperdiagram=e,N.init({engine:ge}),ce.init({engine:ge}),fe.init({engine:ge})},diagramProcess:N,flowSignals:oe,flowControl:ce,dataControl:fe,clearEngine:()=>{ge.dataControl.clearDATA(),ge.flowSignals.clearSignals(),ge.diagramProcess.clearExternalProcesses()},diagramInfo:()=>({process:ge.diagramProcess.infoDiagramProcess(),signals:ge.flowSignals.infoDiagramSignals({diagram:pe.hyperdiagram}),data:ge.dataControl.infoDiagramDATA()}),createEngine:e=>new he(e)},ye=ge,be={init:ye.init,engine:ye};T.node.init();const ve=T,me=be.engine},449:e=>{function t(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}e.exports=function(e){return(e=e||{}).circles?function(e){var n=[],r=[];return e.proto?function e(s){if("object"!=typeof s||null===s)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return o(s,e);var i={};for(var a in n.push(s),r.push(i),s){var c=s[a];if("object"!=typeof c||null===c)i[a]=c;else if(c instanceof Date)i[a]=new Date(c);else if(ArrayBuffer.isView(c))i[a]=t(c);else{var d=n.indexOf(c);i[a]=-1!==d?r[d]:e(c)}}return n.pop(),r.pop(),i}:function e(s){if("object"!=typeof s||null===s)return s;if(s instanceof Date)return new Date(s);if(Array.isArray(s))return o(s,e);var i={};for(var a in n.push(s),r.push(i),s)if(!1!==Object.hasOwnProperty.call(s,a)){var c=s[a];if("object"!=typeof c||null===c)i[a]=c;else if(c instanceof Date)i[a]=new Date(c);else if(ArrayBuffer.isView(c))i[a]=t(c);else{var d=n.indexOf(c);i[a]=-1!==d?r[d]:e(c)}}return n.pop(),r.pop(),i};function o(e,o){for(var s=Object.keys(e),i=new Array(s.length),a=0;a<s.length;a++){var c=s[a],d=e[c];if("object"!=typeof d||null===d)i[c]=d;else if(d instanceof Date)i[c]=new Date(d);else if(ArrayBuffer.isView(d))i[c]=t(d);else{var l=n.indexOf(d);i[c]=-1!==l?r[l]:o(d)}}return i}}(e):e.proto?function e(r){if("object"!=typeof r||null===r)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return n(r,e);var o={};for(var s in r){var i=r[s];"object"!=typeof i||null===i?o[s]=i:i instanceof Date?o[s]=new Date(i):ArrayBuffer.isView(i)?o[s]=t(i):o[s]=e(i)}return o}:function e(r){if("object"!=typeof r||null===r)return r;if(r instanceof Date)return new Date(r);if(Array.isArray(r))return n(r,e);var o={};for(var s in r)if(!1!==Object.hasOwnProperty.call(r,s)){var i=r[s];"object"!=typeof i||null===i?o[s]=i:i instanceof Date?o[s]=new Date(i):ArrayBuffer.isView(i)?o[s]=t(i):o[s]=e(i)}return o};function n(e,n){for(var r=Object.keys(e),o=new Array(r.length),s=0;s<r.length;s++){var i=r[s],a=e[i];"object"!=typeof a||null===a?o[i]=a:a instanceof Date?o[i]=new Date(a):ArrayBuffer.isView(a)?o[i]=t(a):o[i]=n(a)}return o}}}},t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}return n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(405)})();