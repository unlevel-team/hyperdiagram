/*! For license information please see index.5ebae64f18072941d59e.bundle.js.LICENSE.txt */
(self.webpackChunkhyperdiagram=self.webpackChunkhyperdiagram||[]).push([[826],{574:(e,t,n)=>{"use strict";var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function r(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e){return"function"==typeof e}var a=!1,s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack,a=e},get useDeprecatedSynchronousErrorHandling(){return a}};function c(e){setTimeout((function(){throw e}),0)}var l={closed:!0,next:function(e){},error:function(e){if(s.useDeprecatedSynchronousErrorHandling)throw e;c(e)},complete:function(){}},d=function(){return Array.isArray||function(e){return e&&"number"==typeof e.length}}();function u(e){return null!==e&&"object"==typeof e}var p=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),h=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,o=n._parentOrParents,r=n._ctorUnsubscribe,a=n._unsubscribe,s=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,o instanceof e)o.remove(this);else if(null!==o)for(var c=0;c<o.length;++c)o[c].remove(this);if(i(a)){r&&(this._unsubscribe=void 0);try{a.call(this)}catch(e){t=e instanceof p?f(e.errors):[e]}}if(d(s)){c=-1;for(var l=s.length;++c<l;){var h=s[c];if(u(h))try{h.unsubscribe()}catch(e){t=t||[],e instanceof p?t=t.concat(f(e.errors)):t.push(e)}}}if(t)throw new p(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var o=n;(n=new e)._subscriptions=[o]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function f(e){return e.reduce((function(e,t){return e.concat(t instanceof p?t.errors:t)}),[])}var m=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),y=function(e){function t(n,o,r){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=l;break;case 1:if(!n){i.destination=l;break}if("object"==typeof n){n instanceof t?(i.syncErrorThrowable=n.syncErrorThrowable,i.destination=n,n.add(i)):(i.syncErrorThrowable=!0,i.destination=new g(i,n));break}default:i.syncErrorThrowable=!0,i.destination=new g(i,n,o,r)}return i}return r(t,e),t.prototype[m]=function(){return this},t.create=function(e,n,o){var r=new t(e,n,o);return r.syncErrorThrowable=!1,r},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(h),g=function(e){function t(t,n,o,r){var a,s=e.call(this)||this;s._parentSubscriber=t;var c=s;return i(n)?a=n:n&&(a=n.next,o=n.error,r=n.complete,n!==l&&(i((c=Object.create(n)).unsubscribe)&&s.add(c.unsubscribe.bind(c)),c.unsubscribe=s.unsubscribe.bind(s))),s._context=c,s._next=a,s._error=o,s._complete=r,s}return r(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=s.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):c(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;c(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw e;c(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return s.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(c(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(y),b=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function v(e){return e}function _(e){return 0===e.length?v:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var w=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var o=this.operator,r=function(e,t,n){if(e){if(e instanceof y)return e;if(e[m])return e[m]()}return e||t||n?new y(e,t,n):new y(l)}(e,t,n);if(o?r.add(o.call(r,this.source)):r.add(this.source||s.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),s.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,o=t.destination,r=t.isStopped;if(n||r)return!1;e=o&&o instanceof y?o:null}return!0}(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=E(t))((function(t,o){var r;r=n.subscribe((function(t){try{e(t)}catch(e){o(e),r&&r.unsubscribe()}}),o,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[b]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:_(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=E(e))((function(e,n){var o;t.subscribe((function(e){return o=e}),(function(e){return n(e)}),(function(){return e(o)}))}))},e.create=function(t){return new e(t)},e}();function E(e){if(e||(e=s.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var C=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),T=function(e){function t(t,n){var o=e.call(this)||this;return o.subject=t,o.subscriber=n,o.closed=!1,o}return r(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(h),D=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r(t,e),t}(y),S=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r(t,e),t.prototype[m]=function(){return new D(this)},t.prototype.lift=function(e){var t=new A(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new C;if(!this.isStopped)for(var t=this.observers,n=t.length,o=t.slice(),r=0;r<n;r++)o[r].next(e)},t.prototype.error=function(e){if(this.closed)throw new C;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,o=t.slice(),r=0;r<n;r++)o[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new C;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),o=0;o<t;o++)n[o].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new C;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new C;return this.hasError?(e.error(this.thrownError),h.EMPTY):this.isStopped?(e.complete(),h.EMPTY):(this.observers.push(e),new T(this,e))},t.prototype.asObservable=function(){var e=new w;return e.source=this,e},t.create=function(e,t){return new A(e,t)},t}(w),A=function(e){function t(t,n){var o=e.call(this)||this;return o.destination=t,o.source=n,o}return r(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):h.EMPTY},t}(S);const O={config:{basePath:"/hyperdiagram/editor/"}},N={_env:O,getConfig:()=>O.config},x={subject:null,location:{basePath:null,title:null,url:null,id:null,extra:null},state:{}},P={_env:x,init:({subject:e})=>{x.subject=e,x.location.basePath=N.getConfig().basePath},changeLocation:({state:e={},title:t="",url:n,id:o})=>{history.pushState(e,o,n),window.dispatchEvent(new PopStateEvent("popstate"))},changeView:({urlView:e})=>{const{basePath:t}=x.location,{protocol:n,host:o}=window.location,r=`${n}//${o}${t}`;P.changeLocation({url:`${r}${e}`,id:null})},getLocation:()=>P._env.location,notifyLocationChange:({state:e={},title:t,url:n,id:o,extra:r=null})=>{x.state=e;const{location:i,subject:a}=x;i.title=t,i.url=n,i.id=o,i.extra=r,a.next({state:e,location:i})},listenLocationChanges:({listener:e})=>{const{subject:t}=P._env;return t.subscribe({next:e})},subscribeToLocationChanges:({subscriber:e})=>{const{subject:t}=P._env;return t.subscribe(e)}},I=P,j={generateID:({otherIDs:e})=>{let t=null;do{t=j.makeid(11)}while(void 0!==e[t]);return t},makeid:e=>{for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*o));return t}},L=j,M={connectionsALL:{},connections:{}},k={createConnection:({type:e,source:t,target:n})=>{if(k.getConnections({source:t,target:n}).length>0)return null;const o={id:L.generateID({otherIDs:M.connectionsALL}),type:e,source:t,target:n};return M.connectionsALL[o.id]=o,M.connections[o.id]=o,o},addConnection:({connection:e})=>{M.connectionsALL[e.id]=e,M.connections[e.id]=e},getConnection:({id:e=null})=>null!==e&&M.connections[e]||null,getConnections:({source:e=null,target:t=null})=>null!==e&&null===t?Object.values(M.connections).filter((t=>t.source===e)):null!==t&&null===e?Object.values(M.connections).filter((e=>e.target===t)):null!==e&&null!==t?Object.values(M.connections).filter((n=>n.source===e&&n.target===t)):[],getAllConnections:()=>M.connectionsALL,deleteConnection:({id:e})=>void 0===M.connections[e]?null:(delete M.connections[e],delete M.connectionsALL[e],!0),clearAllConnections:()=>{Object.keys(M.connectionsALL).forEach((e=>{k.deleteConnection({id:e})}))}},R=k,V={FLOW:{STEP_START:"step-start",STEP_END:"step-end"},DATA:{DATA_IN:"data-in",DATA_OUT:"data-out"}},U={connectorsALL:{},connectors:{}},z={TYPES:V,_env:U,addConnector:({node:e,type:t,position:n=0})=>{const{connectorsALL:o}=z._env,r={id:null,type:t,position:n,node:e};switch(t){case V.FLOW.STEP_START:r.id=L.generateID({otherIDs:o}),e.connectors.flow[r.id]=r;break;case V.FLOW.STEP_END:r.id=L.generateID({otherIDs:o}),z._checkConnectorPosition({connectors:z.getConnectors({node:e,type:t}),position:n}),e.connectors.flow[r.id]=r;break;case V.DATA.DATA_IN:case V.DATA.DATA_OUT:r.id=L.generateID({otherIDs:o}),e.connectors.data[r.id]=r}return null!==r.id&&(U.connectorsALL[r.id]=r,U.connectors[r.id]=r),r.id},getConnector:({id:e})=>U.connectors[e],getConnectorDATA:({id:e})=>{const{node:t,...n}=U.connectorsALL[e];return n},getConnectors:({node:e=null,type:t=null})=>{const{connectors:n}=U;let o=[];return null!==e&&null===t?o=Object.values(n).filter((t=>t.node.id===e.id)):null!==t&&null===e?o=Object.values(n).filter((e=>e.type===t)):null!==e&&null!==t&&(o=Object.values(n).filter((n=>n.node.id===e.id&&n.type===t))),o},deleteConnector:({node:e,type:t,id:n})=>{let o=!1;switch(t){case V.FLOW.STEP_START:void 0!==e.connectors.flow[n]&&(delete e.connectors.flow[n],o=!0);break;case V.FLOW.STEP_END:void 0!==e.connectors.flow[n]&&(z._deleteConnectorByPosition({connectors:Object.values(e.connectors.flow).filter((e=>e.type===V.FLOW.STEP_END)),position:e.connectors.flow[n].position}),delete e.connectors.flow[n],o=!0);break;case V.DATA.DATA_IN:case V.DATA.DATA_OUT:void 0!==e.connectors.data[n]&&(delete e.connectors.data[n],o=!0)}return R.getConnections({source:n}).forEach((e=>R.deleteConnection({id:e.id}))),R.getConnections({target:n}).forEach((e=>R.deleteConnection({id:e.id}))),!0===o&&(delete U.connectorsALL[n],delete U.connectors[n]),o},_checkConnectorPosition:({connectors:e,position:t})=>{const n=Array.isArray(e)?e:Object.values(e);n.length<t&&(t=n.length),n.sort(((e,t)=>e.position>t.position?1:e.position<t.position?-1:0));for(let e=t;e<n.length;e++)n[e].position++},_deleteConnectorByPosition:({connectors:e,position:t})=>{const n=Object.values(e);if(n.length<t)throw Error("Bad position");n.sort(((e,t)=>e.position>t.position?1:e.position<t.position?-1:0));for(let e=t+1;e<n.length;e++)n[e].position--},loadConnectors:({node:e})=>{Object.values(e.connectors.flow).forEach((t=>{t.node=e,U.connectors[t.id]=t,U.connectorsALL[t.id]=t})),Object.values(e.connectors.data).forEach((t=>{t.node=e,U.connectors[t.id]=t,U.connectorsALL[t.id]=t}))}},B=z,F={id:null,name:null,description:null,properties:{}},$={id:null,reference:null},H={states:{},referencesALL:{},references:{}},W={_env:H,addState:({id:e,name:t,description:n,properties:o})=>{if(void 0!==H.states[e])throw new Error("State id already exists");const r={...F,id:e,name:t,description:n,properties:o};H.states[e]=r},getStates:()=>H.states,getState:({id:e})=>H.states[e],updateState:({id:e,name:t,description:n,properties:o})=>{if(void 0===H.states[e])throw new Error("State id not exists");const r={...F,id:e,name:t,description:n,properties:o};H.states[e]=r},deleteState:({id:e})=>void 0===H.states[e]?null:(Object.values(H.references).filter((t=>t.reference===e)).forEach((e=>{W.deleteReference({id:e.id})})),delete H.states[e],!0),clearStates:()=>{Object.values(H.states).forEach((e=>W.deleteState(e)))},addReference:({id:e=null,state:t})=>{if(void 0===H.states[t])throw new Error("State id not exists");if(void 0!==H.referencesALL[e])throw new Error("State reference id already exists");const n={...$,id:e,reference:t};return H.referencesALL[e]=n,H.references[e]=n,n},getReferences:()=>H.references,getAllReferences:()=>H.referencesALL,getReference:({id:e})=>H.references[e],getStateReferences:({id:e})=>Object.values(H.references).filter((t=>t.reference===e)),deleteReference:({id:e})=>void 0===H.references[e]?null:(delete H.references[e],delete H.referencesALL[e],!0)},Y=W,G={nodesDEFS:{flow_step_default:{def:{name:"flow step default",category:"flow",family:"step",type:"default",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}]},create:({node:e})=>e,delete:({node:e})=>{}},data_state_default:{def:{name:"data state default",category:"data",family:"state",type:"default",connectors:[{type:"data-in"},{type:"data-out"}]},create:({node:e})=>{null===e.extra&&(e.extra={}),e.extra={source:null,state:null,reference:null,...e.extra};const t=Y.getState({id:e.extra.source});e.extra.state=t;const n=Y.addReference({id:e.id,state:e.extra.source});return e.extra.reference=n.id,e},delete:({node:e})=>{Y.deleteReference({id:e.extra.reference})},getDATA:({node:e})=>({...e,extra:{...e.extra,state:null}})},flow_step_pause:{def:{name:"flow step pause",category:"flow",family:"step",type:"pause",connectors:[{type:"step-start"},{type:"step-end"}]},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t})=>{t.flowControl.pauseFlow()}}},flow_step_function_call:{def:{name:"flow step function call",category:"flow",family:"step",type:"function-call",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}],attributes:{"function-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t,data:n})=>{t.diagramProcess.getExternalProcess({id:e.extra.attributes["function-name"].value})({engine:t,data:n})}}},flow_signal_listen:{def:{name:"flow signal listen",category:"flow",family:"signal",type:"listen",connectors:[{type:"step-end"}],attributes:{"signal-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{processDiagram:({diagram:e,engine:t})=>{const n=e.node.getNodes();let o=[];Object.values(n).filter((e=>"flow"===e.category&&"signal"===e.family&&"listen"===e.type)).forEach((e=>{const n=e.extra.attributes["signal-name"].value;o.includes(n)||(o.push(n),t.flowSignals.listenToSignal({signal:n,listener:()=>{t.flowControl.gotoNode({id:e.id})}}))}))}}},flow_signal_emit:{def:{name:"flow signal emit",category:"flow",family:"signal",type:"emit",connectors:[{type:"step-start"}],attributes:{"signal-name":{type:"string",value:null}}},create:({node:e})=>e,delete:({node:e})=>{},process:{run:({node:e,engine:t})=>{t.flowSignals.notifySignal({signal:e.extra.attributes["signal-name"].value})}}}},categories:{}},q={_env:G,init:()=>{Object.keys(G.nodesDEFS).forEach((e=>{q.defineNode({nodeDEF:G.nodesDEFS[e]})}))},defineNode:({nodeDEF:e})=>{const{category:t,family:n,type:o}=e.def;void 0===G.categories[t]&&(G.categories[t]={name:t,families:{}});const r=G.categories[t];void 0===r.families[n]&&(r.families[n]={name:n,types:{}});const i=r.families[n];if(void 0!==i.types[o])throw new Error("Node type already defined");i.types[o]={name:o,def:e}},getNodeDEF:({category:e,family:t,type:n})=>{const o=G.categories[e];if(void 0===o)throw new Error("Category not found.");const r=o.families[t];if(void 0===r)throw new Error("Family not found.");const i=r.types[n];if(void 0===i)throw new Error("Type not found.");return i.def},getAllNodeDEFS:()=>G.nodesDEFS},X=q;var Z=n(449),K=n.n(Z);const J=e=>K()({proto:!0})(e),Q={nodesALL:{},nodes:{}},ee={_env:Q,init:()=>{X.init()},create:({category:e,family:t,type:n,extra:o={}})=>{const r=X.getNodeDEF({category:e,family:t,type:n});let i={id:L.generateID({otherIDs:Q.nodesALL}),class:"node",category:e,family:t,type:n,name:null,extra:{...o,attributes:{...J(r.def.attributes),...o.attributes}},connectors:{flow:{},data:{}}};return i.name=`${r.def.name} - ${i.id}`,void 0!==r.def.connectors.find((e=>"step-start"===e.type))&&B.addConnector({node:i,type:B.TYPES.FLOW.STEP_START}),void 0!==r.def.connectors.find((e=>"step-end"===e.type))&&B.addConnector({node:i,type:B.TYPES.FLOW.STEP_END}),void 0!==r.def.connectors.find((e=>"data-in"===e.type))&&B.addConnector({node:i,type:B.TYPES.DATA.DATA_IN}),void 0!==r.def.connectors.find((e=>"data-out"===e.type))&&B.addConnector({node:i,type:B.TYPES.DATA.DATA_OUT}),i=r.create({node:i}),Q.nodesALL[i.id]=i,Q.nodes[i.id]=i,i},delete:({id:e})=>{if(void 0===Q.nodes[e])return null;const t=Q.nodes[e];return X.getNodeDEF(t).delete({node:t}),B.getConnectors({node:t}).forEach((e=>B.deleteConnector({node:t,type:e.type,id:e.id}))),delete Q.nodes[e],delete Q.nodesALL[e],!0},getNode:({id:e})=>Q.nodes[e],getNodeDEF:X.getNodeDEF,getAllNodeDEFS:X.getAllNodeDEFS,getNodeDATA:({id:e})=>{const t=Q.nodes[e];let n={...t,connectors:{flow:{},data:{}}};Object.values(t.connectors.flow).forEach((e=>{n.connectors.flow[e.id]=B.getConnectorDATA(e)})),Object.values(t.connectors.data).forEach((e=>{n.connectors.data[e.id]=B.getConnectorDATA(e)}));const o=X.getNodeDEF(t);return void 0!==o.getDATA&&(n=o.getDATA({node:n})),n},getNodes:()=>Q.nodes,getAllNodes:()=>Q.nodesALL,getAllNodesDATA:()=>{const e={};return Object.values(Q.nodesALL).forEach((t=>{e[t.id]=ee.getNodeDATA(t)})),e},clearAllNodes:()=>{Object.keys(Q.nodesALL).forEach((e=>{ee.delete({id:e})}))},loadNode:({nodeDATA:e})=>{const t=X.getNodeDEF(e);let n={...e};B.loadConnectors({node:n}),n=t.create({node:n}),Q.nodesALL[n.id]=n,Q.nodes[n.id]=n}},te=ee,ne={states:Y},oe={node:te,connectors:B,connection:R,data:ne,init:()=>{te.init()},getDATA:()=>{const e={nodes:te.getAllNodesDATA(),connections:R.getAllConnections(),data:{states:ne.states.getStates(),references:ne.states.getAllReferences()}};return JSON.stringify(e,null,2)},loadDATA:({data:e})=>{te.clearAllNodes(),Y.clearStates(),Object.values(e.data.states).forEach((e=>ne.states.addState(e))),Object.values(e.nodes).forEach((e=>te.loadNode({nodeDATA:e}))),Object.values(e.connections).forEach((e=>R.addConnection({connection:e})))}},re={CREATE:"create",UPDATE:"update",DELETE:"delete"},ie={ACTIONS:re,_env:{subject:null},init:({subject:e})=>{ie._env.subject=e,oe.init()},create:e=>{const t=oe.node.create(e);return ie.notifyChange({action:re.CREATE,payload:t}),t},getNode:({id:e})=>oe.node.getNode({id:e}),getNodes:()=>oe.node.getNodes(),updateNode:({node:e})=>{ie.notifyChange({action:re.UPDATE,payload:{id:e.id}})},delete:({id:e})=>{!0===oe.node.delete({id:e})&&ie.notifyChange({action:re.DELETE,payload:e})},notifyChange:({action:e,payload:t})=>{const{subject:n}=ie._env;n.next({action:e,payload:t})},listenChanges:({listener:e})=>{const{subject:t}=ie._env;return t.subscribe({next:e})},subscribeToChanges:({subscriber:e})=>{const{subject:t}=ie._env;return t.subscribe(e)}},ae=ie,se={CREATE:"create",UPDATE:"update",DELETE:"delete"},ce={ACTIONS:se,_env:{subject:null},init:({subject:e})=>{ce._env.subject=e},addConnector:({node:e,type:t,position:n=0})=>{const o=oe.connectors.addConnector({node:e,type:t,position:n});if(null===o)return null;const r=oe.connectors.getConnector({id:o});ce.notifyChange({action:se.CREATE,payload:r})},getConnector:({id:e})=>oe.connectors.getConnector({id:e}),updateConnector:({connector:e})=>{ce.notifyChange({action:se.UPDATE,payload:{id:e.id}})},deleteConnector:({node:e,type:t,id:n})=>{!0===oe.connectors.deleteConnector({node:e,type:t,id:n})&&ce.notifyChange({action:se.DELETE,payload:n})},notifyChange:({action:e,payload:t})=>{const{subject:n}=ce._env;n.next({action:e,payload:t})},listenChanges:({listener:e})=>{const{subject:t}=ce._env;return t.subscribe({next:e})},subscribeToChanges:({subscriber:e})=>{const{subject:t}=ce._env;return t.subscribe(e)}},le=ce,de={CREATE:"create",DELETE:"delete"},ue={ACTIONS:de,_env:{subject:null},init:({subject:e})=>{ue._env.subject=e},createConnection:({type:e,source:t,target:n})=>{const o=oe.connection.createConnection({type:e,source:t,target:n});return null===o||ue.notifyChange({action:de.CREATE,payload:o}),o},getConnection:({id:e})=>oe.connection.getConnection({id:e}),getConnections:oe.connection.getConnections,deleteConnection:({id:e})=>{const t=oe.connection.deleteConnection({id:e});return!0===t&&ue.notifyChange({action:de.DELETE,payload:e}),t},notifyChange:({action:e,payload:t})=>{const{subject:n}=ue._env;n.next({action:e,payload:t})},listenChanges:({listener:e})=>{const{subject:t}=ue._env;return t.subscribe({next:e})},subscribeToChanges:({subscriber:e})=>{const{subject:t}=ue._env;return t.subscribe(e)}},pe=ue,he={subject:null,selection:{type:null,id:null,object:null}},fe={_env:he,init:({subject:e})=>{he.subject=e},getSelection:()=>he.selection,select:({type:e,id:t,object:n})=>{he.selection={...he.selection,type:e,id:t,object:n},fe.notifyChange({action:"select",payload:he.selection})},selectNONE:()=>{he.selection={type:null,id:null,object:null},fe.notifyChange({action:"selectNONE",payload:null})},notifyChange:({action:e,payload:t})=>{const{subject:n}=he;n.next({action:e,payload:t})},listenChanges:({listener:e})=>{const{subject:t}=he;return t.subscribe({next:e})},subscribeToChanges:({subscriber:e})=>{const{subject:t}=he;return t.subscribe(e)}},me=fe,ye={CREATE:"create",UPDATE:"update",DELETE:"delete",EDITOR_SELECT:"editor-select",CREATE_REF:"create-ref",UPDATE_REF:"update-ref",DELETE_REF:"delete-ref"},ge={subject:null,selectedState:null},be={_env:ge,ACTIONS:ye,init:({subject:e})=>{ge.subject=e},create:e=>{oe.data.states.addState(e),be.notifyChange({action:ye.CREATE,payload:{id:e.id}})},getStates:()=>oe.data.states.getStates(),getState:({id:e})=>oe.data.states.getState({id:e}),update:e=>{oe.data.states.updateState(e),be.notifyChange({action:ye.UPDATE,payload:{id:e.id}})},delete:({id:e})=>{!0===oe.data.states.deleteState({id:e})&&be.notifyChange({action:ye.DELETE,payload:{id:e}})},createReference:e=>{oe.data.states.addReference(e),be.notifyChange({action:ye.CREATE_REF,payload:{id:e.id}})},getReferences:()=>oe.data.states.getReferences(),getReference:({id:e})=>oe.data.states.getReference({id:e}),getStateReferences:({id:e})=>oe.data.states.getStateReferences({id:e}),updateReference:({id:e})=>{be.notifyChange({action:ye.UPDATE_REF,payload:{id:e}})},deleteReference:({id:e})=>{!0===oe.data.states.deleteReference({id:e})&&be.notifyChange({action:ye.DELETE_REF,payload:{id:e}})},selectState:({id:e})=>{ge.selectedState=be.getState({id:e}),be.notifyChange({action:ye.EDITOR_SELECT,payload:{state:ge.selectedState}})},deSelectState:()=>{ge.selectedState=null,be.notifyChange({action:ye.EDITOR_SELECT,payload:{state:ge.selectedState}})},getSelectedState:()=>ge.selectedState,notifyChange:({action:e,payload:t})=>{const{subject:n}=ge;n.next({action:e,payload:t})},listenChanges:({listener:e})=>{const{subject:t}=ge;return t.subscribe({next:e})},subscribeToChanges:({subscriber:e})=>{const{subject:t}=ge;return t.subscribe(e)}},ve=be,_e={_env:{states:{}},init:()=>{const{states:e}=_e._env;e.config=N,I.init({subject:new S}),e.location=I,ae.init({subject:new S}),e.nodes=ae,le.init({subject:new S}),e.connectors=le,pe.init({subject:new S}),e.connections=pe,me.init({subject:new S}),e.selection=me,ve.init({subject:new S}),e["data-states"]=ve},getState:({name:e})=>_e._env.states[e]},we=_e;var Ee=n(16);const Ce={engine:null,diagram:null,externalProcesses:{}};class Te{constructor(e){this._env={engine:e,diagram:e.hyperdiagram,externalProcesses:{}}}process(){const{diagram:e,engine:t}=this._env,n=e.node.getAllNodeDEFS();Object.values(n).forEach((n=>{const{process:o}=n;void 0!==o&&void 0!==o.processDiagram&&o.processDiagram({diagram:e,engine:t})}))}addExternalProcess({id:e,process:t}){this._env.externalProcesses[e]=t}getExternalProcess({id:e}){return this._env.externalProcesses[e]}clearExternalProcesses(){const{externalProcesses:e}=this._env;Object.keys(e).forEach((t=>{delete e[t]}))}get info(){return De.infoDiagramProcess(this._env.diagram)}}const De={init:({engine:e})=>{Ce.engine=e,Ce.diagram=e._env.hyperdiagram},processDiagram:(e=Ce.diagram)=>{const t=e.node.getAllNodeDEFS();Object.values(t).forEach((e=>{void 0!==e.process&&void 0!==e.process.processDiagram&&e.process.processDiagram({diagram:Ce.diagram,engine:Ce.engine})}))},addExternalProcess:({id:e,process:t})=>{Ce.externalProcesses[e]=t},getExternalProcess:({id:e})=>Ce.externalProcesses[e],clearExternalProcesses:()=>{Object.keys(Ce.externalProcesses).forEach((e=>{delete Ce.externalProcesses[e]}))},infoDiagramProcess:(e=Ce.diagram)=>{const t=new Set;return Object.values(e.node.getNodes()).filter((e=>"flow"===e.category&&"step"===e.family&&"function-call"===e.type)).forEach((e=>t.add(e.extra.attributes["function-name"].value))),{external:Array.from(t)||[]}},createDiagramProcess:(...e)=>new Te(...e)},Se=De,Ae={subject:new S,listeners:{}};class Oe{constructor(){this._env={subject:new S,listeners:{}}}notifySignal({signal:e}){const{subject:t}=this._env;t.next({signal:e})}listenToSignal({listener:e,signal:t}){const{_env:n}=this,{subject:o,listeners:r}=n;void 0===r[t]&&(r[t]=[]);const i=o.subscribe({next:n=>{n.signal===t&&e(n)}});return r[t].push({listener:e,subscriber:i}),i}clearSignals(){const{listeners:e}=this._env;Object.keys(e).forEach((t=>{e[t].forEach((e=>e.subscriber.unsubscribe())),delete e[t]}))}}const Ne={notifySignal:({signal:e})=>{const{subject:t}=Ae;t.next({signal:e})},listenToSignal:({listener:e,signal:t})=>{const{subject:n}=Ae;void 0===Ae.listeners[t]&&(Ae.listeners[t]=[]);const o=n.subscribe({next:n=>{n.signal===t&&e(n)}});return Ae.listeners[t].push({listener:e,subscriber:o}),o},clearSignals:()=>{Object.keys(Ae.listeners).forEach((e=>{Ae.listeners[e].forEach((e=>e.subscriber.unsubscribe())),delete Ae.listeners[e]}))},infoDiagramSignals:({diagram:e})=>{const t=new Set,n=new Set;return Object.values(e.node.getNodes()).filter((e=>"flow"===e.category&&"signal"===e.family)).forEach((e=>{switch(e.type){case"listen":t.add(e.extra.attributes["signal-name"].value);break;case"emit":n.add(e.extra.attributes["signal-name"].value)}})),{listen:Array.from(t)||[],emit:Array.from(n)||[]}},createFlowSignals:(...e)=>new Oe(...e)},xe={engine:null,hyperdiagram:null,nextNode:null,onPause:!1,runningNode:!1};class Pe{constructor(e){this._env={engine:e,hyperdiagram:e.hyperdiagram,nextNode:null,onPause:!1,runningNode:!1}}gotoNode(e){const{_env:t}=this,{engine:n,hyperdiagram:o}=t,r=o.node.getNode({id:e}),i=o.node.getNodeDEF(r);t.runningNode=!0,t.onPause=!1,t.nextNode=null,n.dataControl.setDataFromNode({node:r});const a=n.dataControl.getDATA();i.process&&i.process.run&&i.process.run({node:r,engine:n,data:a});const s=Object.values(r.connectors.flow).filter((e=>"step-end"===e.type))[0];if(void 0!==s){const e=o.connection.getConnections({source:s.id})[0];if(void 0!==e){const n=o.connectors.getConnector({id:e.target});t.nextNode=n.node.id}}t.runningNode=!1,requestAnimationFrame((()=>Ie.nextStep()))}nextStep(){const{_env:e}=this;e.onPause||null!==e.nextNode&&this.gotoNode(e.nextNode)}pauseFlow(){this._env.onPause=!0}get isOnPause(){return this._env.onPause}}const Ie={init:({engine:e})=>{xe.engine=e,xe.hyperdiagram=e._env.hyperdiagram},gotoNode:({id:e})=>{const t=xe.hyperdiagram.node.getNode({id:e}),n=xe.hyperdiagram.node.getNodeDEF(t);xe.runningNode=!0,xe.onPause=!1,xe.nextNode=null,xe.engine.dataControl.setDataFromNode({node:t});const o=xe.engine.dataControl.getDATA();n.process&&n.process.run&&n.process.run({node:t,engine:xe.engine,data:o});const r=Object.values(t.connectors.flow).filter((e=>"step-end"===e.type))[0];if(void 0!==r){const e=xe.hyperdiagram.connection.getConnections({source:r.id})[0];if(void 0!==e){const t=xe.hyperdiagram.connectors.getConnector({id:e.target});xe.nextNode=t.node.id}}xe.runningNode=!1,requestAnimationFrame((()=>Ie.nextStep()))},nextStep:()=>{xe.onPause||null!==xe.nextNode&&Ie.gotoNode({id:xe.nextNode})},pauseFlow:()=>{xe.onPause=!0},createFlowControl:(...e)=>new Pe(...e)},je=Ie,Le={engine:null,hyperdiagram:null,dataIN:{},dataOUT:{}};class Me{constructor(e){this._env={engine:e,hyperdiagram:e.hyperdiagram,dataIN:{},dataOUT:{}}}setDataFromNode(e){const{_env:t}=this,{hyperdiagram:n}=t;t.dataIN={},t.dataOUT={};const o=n.connectors.getConnectors({node:e,type:"data-in"})[0];void 0!==o&&n.connection.getConnections({target:o.id}).forEach((e=>{const o=n.connectors.getConnector({id:e.source}),r=n.data.states.getState({id:o.node.extra.source});t.dataIN[r.id]=Object.values(r.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}));const r=n.connectors.getConnectors({node:e,type:"data-out"})[0];void 0!==r&&n.connection.getConnections({source:r.id}).forEach((e=>{const o=n.connectors.getConnector({id:e.target}),r=n.data.states.getState({id:o.node.extra.source});t.dataOUT[r.id]=Object.values(r.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}))}get data(){const{_env:e}=this;return{dataIN:e.dataIN,dataOUT:e.dataOUT}}get info(){return ke.infoDiagramDATA(this._env.hyperdiagram)}clearDATA(){const{_env:e}=this;e.dataIN={},e.dataOUT={}}updateOutputDATA(){const{_env:e}=this;Object.keys(e.dataOUT).forEach((t=>{const n=e.hyperdiagram.data.states.getState({id:t});Object.keys(e.dataOUT[t]).forEach((o=>{n.properties[o].value=e.dataOUT[t][o]}))}))}}const ke={init:({engine:e})=>{Le.engine=e,Le.hyperdiagram=e._env.hyperdiagram},setDataFromNode:({node:e})=>{Le.dataIN={},Le.dataOUT={};const t=Le.hyperdiagram.connectors.getConnectors({node:e,type:"data-in"})[0];void 0!==t&&Le.hyperdiagram.connection.getConnections({target:t.id}).forEach((e=>{const t=Le.hyperdiagram.connectors.getConnector({id:e.source}),n=Le.hyperdiagram.data.states.getState({id:t.node.extra.source});Le.dataIN[n.id]=Object.values(n.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}));const n=Le.hyperdiagram.connectors.getConnectors({node:e,type:"data-out"})[0];void 0!==n&&Le.hyperdiagram.connection.getConnections({source:n.id}).forEach((e=>{const t=Le.hyperdiagram.connectors.getConnector({id:e.target}),n=Le.hyperdiagram.data.states.getState({id:t.node.extra.source});Le.dataOUT[n.id]=Object.values(n.properties).reduce(((e,t)=>(e[t.id]=t.value,e)),{})}))},getDATA:()=>({dataIN:Le.dataIN,dataOUT:Le.dataOUT}),clearDATA:()=>{Le.dataIN={},Le.dataOUT={}},updateOutputDATA:()=>{Object.keys(Le.dataOUT).forEach((e=>{const t=Le.hyperdiagram.data.states.getState({id:e});Object.keys(Le.dataOUT[e]).forEach((n=>{t.properties[n].value=Le.dataOUT[e][n]}))}))},infoDiagramDATA:(e=Le.hyperdiagram)=>{const t=new Set;return Object.values(e.node.getNodes()).filter((e=>"data"===e.category&&"state"===e.family&&"default"===e.type)).forEach((e=>{t.add(e.extra.source)})),Array.from(t).reduce(((t,n)=>{t[n]={};const o=e.data.states.getState({id:n});return Object.keys(o.properties).forEach((e=>{t[n][e]=o.properties[e].value})),t}),{})},createDataControl:(...e)=>new Me(...e)},Re=ke,Ve={hyperdiagram:null};class Ue{constructor(e){this._env={hyperdiagram:e},this.diagramProcess=Se.createDiagramProcess(this),this.flowSignals=Ne.createFlowSignals(),this.flowControl=je.createFlowControl(this),this.dataControl=Re.createDataControl(this)}get hyperdiagram(){return this._env.hyperdiagram}clearEngine(){const{dataControl:e,flowSignals:t,diagramProcess:n}=this;e.clearDATA(),t.clearSignals(),n.clearExternalProcesses()}get diagramInfo(){const{dataControl:e,diagramProcess:t,hyperdiagram:n}=this;return{process:t.info(),signals:Ne.infoDiagramSignals({diagram:n}),data:e.info()}}}const ze={_env:Ve,init:({hyperdiagram:e})=>{Ve.hyperdiagram=e,Se.init({engine:ze}),je.init({engine:ze}),Re.init({engine:ze})},diagramProcess:Se,flowSignals:Ne,flowControl:je,dataControl:Re,clearEngine:()=>{ze.dataControl.clearDATA(),ze.flowSignals.clearSignals(),ze.diagramProcess.clearExternalProcesses()},diagramInfo:()=>({process:ze.diagramProcess.infoDiagramProcess(),signals:ze.flowSignals.infoDiagramSignals({diagram:Ve.hyperdiagram}),data:ze.dataControl.infoDiagramDATA()}),createEngine:e=>new Ue(e)},Be=ze,Fe={init:Be.init,engine:Be},$e={manager:null,hyperdiagram:oe},He={init:({manager:e})=>{$e.manager=e,window.diagramTest=He,He.manager=$e.manager,He.hyperdiagram=$e.hyperdiagram,console.log("HYPERDIAGRAM",He.hyperdiagram)},testNodes:()=>{const{manager:e}=$e;e.nodes.create({category:"flow",family:"step",type:"default",extra:{position:{x:-5,y:0,z:0}}}),e.nodes.create({category:"flow",family:"step",type:"default",extra:{position:{x:5,y:0,z:0}}}),e.nodes.create({category:"data",family:"state",type:"default",extra:{position:{x:0,y:0,z:-3}}}),e.nodes.create({category:"flow",family:"step",type:"pause",extra:{position:{x:-5,y:0,z:-9}}}),e.nodes.create({category:"flow",family:"step",type:"function-call",extra:{position:{x:5,y:0,z:-9}}}),e.nodes.create({category:"flow",family:"signal",type:"listen",extra:{position:{x:-5,y:0,z:-16}}}),e.nodes.create({category:"flow",family:"signal",type:"emit",extra:{position:{x:5,y:0,z:-16}}})}},We=He;var Ye=n(776);const Ge={renderer:null},qe=({node:e})=>{const{factory:t}=Ge.renderer,n=t.node.create({node:e}),o=Object.values(e.connectors.data),r=o.find((e=>"data-in"===e.type)),i=o.find((e=>"data-out"===e.type)),a=Object.values(e.connectors.flow),s=a.find((e=>"step-start"===e.type)),c=a.find((e=>"step-end"===e.type));void 0!==r&&(n.connector_dataIN.id=r.id,n.connector_dataIN.model.userData.id=r.id),void 0!==i&&(n.connector_dataOUT.id=i.id,n.connector_dataOUT.model.userData.id=i.id),void 0!==s&&(n.connector_start.id=s.id,n.connector_start.model.userData.id=s.id),void 0!==c&&(n.connectors_end[0].id=c.id,n.connectors_end[0].model.userData.id=c.id),n.id=e.id,n.model.userData.id=e.id,n.model.position.set(e.extra.position.x,e.extra.position.y,e.extra.position.z),Ge.renderer.addNode({node:n})},Xe=({connection:e})=>{const{factory:t}=Ge.renderer,{models:n}=Ge.renderer._env;let o,r;switch(e.type){case"flow":o=n.connectors.stepEND.find((t=>t.id===e.source)),r=n.connectors.stepSTART.find((t=>t.id===e.target));break;case"data":o=n.connectors.dataOUT.find((t=>t.id===e.source)),r=n.connectors.dataIN.find((t=>t.id===e.target))}const i=t.connection.createConnection({type:e.type,startPoint:o.model.getWorldPosition(new Ye.Vector3),endPoint:r.model.getWorldPosition(new Ye.Vector3)});i.id=e.id,i.source=o.id,i.target=r.id,i.model.userData.id=e.id,Ge.renderer.addConnection({connection:i})},Ze={diagramRenderer:null,engine:Fe.engine,init:({renderer:e})=>{Ge.renderer=e,Ze.diagramRenderer=Ge.renderer,Fe.init({hyperdiagram:oe}),ae.listenChanges({listener:Ze._listenerNodes}),ve.listenChanges({listener:Ze._listenerDataStates}),le.listenChanges({listener:Ze._listenerConnectors}),pe.listenChanges({listener:Ze._listenerConnections}),Ze.camera=e.camera,We.init({manager:Ze})},_listenerNodes:e=>{switch(e.action){case ae.ACTIONS.CREATE:qe({node:e.payload});break;case ae.ACTIONS.DELETE:(({id:e})=>{Ge.renderer.removeNode({id:e});const t=me.getSelection();"node"===t.type&&t.id===e&&me.selectNONE()})({id:e.payload})}},_listenerDataStates:e=>{switch(e.action){case ve.ACTIONS.DELETE_REF:}},_listenerConnectors:e=>{},_listenerConnections:e=>{switch(e.action){case pe.ACTIONS.CREATE:Xe({connection:e.payload});break;case pe.ACTIONS.DELETE:(({id:e})=>{Ge.renderer.removeConnection({id:e});const t=me.getSelection();"connection"===t.type&&t.id===e&&me.selectNONE()})({id:e.payload})}},getConfig:()=>N.getConfig(),getDATA:oe.getDATA,loadDATA:e=>{const{renderer:t}=Ge;oe.loadDATA(e),me.selectNONE(),t.clearNodes();const n=oe.node.getAllNodes();Object.values(n).forEach((e=>qe({node:e})));const o=oe.connection.getAllConnections();Object.values(o).forEach((e=>Xe({connection:e})))},nodes:{create:e=>ae.create(e),get:e=>ae.getNode(e),update:e=>ae.updateNode(e),delete:e=>ae.delete(e),getNodes:ae.getNodes},connectors:{add:e=>le.addConnector(e),get:e=>le.getConnector(e),update:e=>le.updateConnector(e),delete:e=>le.deleteConnector(e)},connections:{create:e=>pe.createConnection(e),get:e=>pe.getConnection(e),getConnections:pe.getConnections,delete:e=>pe.deleteConnection(e)},camera:null,tests:We},Ke=Ze;function Je(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){var t=e.target.result;const n=JSON.parse(t);Ke.loadDATA({data:n})},n.readAsText(t)}}const Qe={myDIV:null},et={_env:Qe,init:()=>{const{_env:e}=et;e.myDIV=document.createElement("div"),e.myDIV.classList.add("header")},getComponent(){const{_env:e}=et;return e.myDIV},_render:()=>{const{_env:e}=et,t=Ee.dy`
      <h1>HyperDiagram</h1>
      <div class="Buttons">
        <button data-name="diagram" @click=${et._onClickButton}>📐 Diagram</button>
        <button data-name="data" @click=${et._onClickButton}>📚 Data</button>
        <button data-name="engine" @click=${et._onClickButton}>⚙ Engine</button>
        <button data-name="load-hyperdiagram" @click=${et._onClickButton}>📖 Load</button>
        <button data-name="save-hyperdiagram" @click=${et._onClickButton}>💾 Save</button>
      </div>
      <input type="file" id="file-input" @change=${Je}/>
    `;(0,Ee.sY)(t,e.myDIV)},update:()=>{et._render()},_onClickButton:e=>{switch(e.target.getAttribute("data-name")){case"diagram":I.changeView({urlView:"diagram"});break;case"data":I.changeView({urlView:"data/state"});break;case"engine":I.changeView({urlView:"engine"});break;case"load-hyperdiagram":Qe.myDIV.querySelector("#file-input").click();break;case"save-hyperdiagram":!async function({content:e}){const t=await window.showSaveFilePicker(),n=await t.createWritable();await n.write(new Blob([e],{type:"text/plain"})),await n.close()}({content:Ke.getDATA()})}}},tt=et,nt={flow_signal_listen:{def:{category:"flow",family:"signal",type:"listen"},label:"▶ Signal listen",emoji:"▶"},flow_signal_emit:{def:{category:"flow",family:"signal",type:"emit"},label:"📡 Signal emit",emoji:"📡"},flow_step_pause:{def:{category:"flow",family:"step",type:"pause"},label:"⏸ Pause",emoji:"⏸"},flow_step_function_call:{def:{category:"flow",family:"step",type:"function-call"},label:"⚙ Function call",emoji:"⚙"}},ot={myDIV:null},rt={_env:ot,init:()=>{ot.myDIV=document.createElement("div"),ot.myDIV.classList.add("palette"),ve.listenChanges({listener:rt._listenerDataStatesChange})},getComponent:()=>ot.myDIV,_render:()=>{const e=Ee.dy`
      <strong>Palette</strong><br>
      <fieldset class="Flow">
        <legend>Flow</legend>
        ${Object.values(nt).map((e=>rt._renderItemFlow({item:e})))}
      </fieldset>
      <fieldset class="Data">
        <legend>Data</legend>
        ${Object.values(ve.getStates()).map((e=>rt._renderItemState({item:e})))}
      </fieldset>
    `;(0,Ee.sY)(e,ot.myDIV)},_renderItemFlow:({item:e})=>Ee.dy`
      <div class="item flow" data-category="${e.def.category}" data-family="${e.def.family}" data-type="${e.def.type}">
        <button @click=${rt._onClickButtonItemFlow}>${e.label}</button>
      </div>
    `,_renderItemState:({item:e})=>Ee.dy`
      <div class="item state" data-id="${e.id}">
        <button @click=${rt._onClickButtonItemState}>📄 ${e.name}</button>
      </div>
    `,update:()=>{rt._render()},_listenerDataStatesChange:({action:e,payload:t})=>{switch(e){case ve.ACTIONS.CREATE:case ve.ACTIONS.DELETE:rt.update()}},_onClickButtonItemFlow:e=>{const t=e.target.parentElement.getAttribute("data-category"),n=e.target.parentElement.getAttribute("data-family"),o=e.target.parentElement.getAttribute("data-type"),r=Ke.camera.getPosition();r.y=0,Ke.nodes.create({category:t,family:n,type:o,extra:{position:r}})},_onClickButtonItemState:e=>{const t=e.target.parentElement.getAttribute("data-id"),n=Ke.camera.getPosition();n.y=0,Ke.nodes.create({category:"data",family:"state",type:"default",extra:{position:n,source:t}})}},it=rt,at={myDIV:null,nodes:null,connections:null,selection:null},st={_env:at,init:()=>{at.myDIV=document.createElement("div"),at.myDIV.classList.add("outline"),at.nodes=ae.getNodes(),at.selection=me.getSelection(),ae.listenChanges({listener:st._listenerNodesUpdate}),me.listenChanges({listener:st._listenerSelectionChange})},getComponent:()=>at.myDIV,_render:()=>{const e=Ee.dy`
      <strong>Outline</strong> <br>
      <fieldset data-name="nodes">
        <legend>Nodes</legend>
        ${Object.values(at.nodes).map((e=>st._renderNode({node:e})))}
      </fieldset>
    `;(0,Ee.sY)(e,at.myDIV)},_renderNode:({node:e})=>{let t="";if("data"===e.category)t="📄";else if("flow"===e.category){const n=Object.values(nt).find((t=>t.def.category===e.category&&t.def.family===e.family&&t.def.type===e.type));void 0!==n&&(t=n.emoji)}return Ee.dy`
      <div class="node" data-id="${e.id}">
        <button @click=${st._onClickButtonNode}>${t} ${e.id}</button>
      </div>
    `},update:()=>{st._render(),at.selection=me.getSelection(),st._updateSelectedNode()},_updateSelectedNode:()=>{if(at.myDIV.querySelectorAll("div.node button").forEach((e=>{e.classList.remove("selected")})),"node"!==at.selection.type)return;const e=at.myDIV.querySelector(`div.node[data-id="${at.selection.id}"] button`);null!==e&&e.classList.add("selected")},_listenerNodesUpdate:({action:e,payload:t})=>{st.update()},_listenerSelectionChange:({action:e,payload:t})=>{st.update()},_onClickButtonNode:e=>{const t=e.target.parentElement.getAttribute("data-id");"node"===at.selection.type&&at.selection.id===t||me.select({type:"node",id:t,object:ae.getNode({id:t})})}},ct=st,lt=({element:e})=>{e.style.display="block"},dt=({element:e})=>{e.style.display="none"};class ut{constructor({element:e}){this._element=e,this.open=this.open.bind(this),this.close=this.close.bind(this),this._onWindowClick=this._onWindowClick.bind(this),window.addEventListener("click",this._onWindowClick),this._element.querySelector(".modal .close").addEventListener("click",this.close)}dispose(){window.removeEventListener("click",this._onWindowClick),this._element.querySelector(".modal .close").removeEventListener("click",this.close),delete this._element}open(){lt({element:this._element})}close(){dt({element:this._element})}_onWindowClick(e){e.target===this._element&&this.close()}}const pt={myDIV:null,selection:{type:null,id:null},selectedNode:null,selectedNodeINRender:null,modalDelete:null},ht={_env:pt,init:()=>{pt.myDIV=document.createElement("div"),pt.myDIV.classList.add("properties"),ae.listenChanges({listener:ht._listenerNodeChanges}),me.listenChanges({listener:ht._listenerSelectionChanges}),ht.update(),pt.modalDelete=new ut({element:pt.myDIV.querySelector("#modal-delete")})},getComponent:()=>pt.myDIV,_render:()=>{const e=Ee.dy`
      <div class="CommonInfo">
        <strong>type:</strong> ${pt.selection.type} <br>
        <strong>ID:</strong> ${pt.selection.id} <br>
      </div>
      ${ht._renderDetails()}
      ${ht._renderOptions()}
      ${ht._renderModalDelete()}
    `;(0,Ee.sY)(e,pt.myDIV)},_renderModalDelete:()=>Ee.dy`
    <!-- The Modal -->
    <div id="modal-delete" class="modal info">
    
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <span class="close">&times;</span>
          <h2>Delete?</h2>
        </div>
        <div class="modal-body">
          <p>Do you really want to delete this element?</p>
          <p>
            <button type="button" @click="${ht._onButtonConfirmDeleteClick}">Yes</button>
            <button type="button" @click="${()=>pt.modalDelete&&pt.modalDelete.close()}">No</button>
          </p>
        </div>
        <div class="modal-footer">
          <!-- <h3>Modal Footer</h3> -->
        </div>
      </div>
    
    </div>
    `,_renderDetails:()=>{let e=null;switch(pt.selection.type){case"node":case"connection":const t=pt.selection.object;e=Ee.dy`
          <fieldset class="Details">
            <legend>Details</legend>
            <strong>class:</strong> ${t.class} <br>
            <strong>category:</strong> ${t.category} <br>
            <strong>family:</strong> ${t.family} <br>
            <strong>type:</strong> ${t.type} <br>
            ${ht._renderDetailsForNode()}
          </fieldset>
          ${ht._renderAttributesForNode()}
        `}return e},_renderDetailsForNode:()=>{if("node"!==pt.selection.type)return;const e=pt.selectedNodeINRender;return Ee.dy`
      <strong>position X:</strong> ${e.model.position.x.toFixed(5)} <br>
      <strong>position Z:</strong> ${e.model.position.z.toFixed(5)} <br>
    `},_renderAttributesForNode:()=>{if("node"!==pt.selection.type)return;const e=pt.selectedNode,{attributes:t}=e.extra;return void 0===t||Object.keys(t).length<1?void 0:Ee.dy`
    <fieldset class="Attributes">
      <legend>Attributes</legend>
      ${Object.keys(t).map((e=>ht._renderAttributeForNode({name:e})))}
    </fieldset>
    `},_renderAttributeForNode:({name:e})=>{const{attributes:t}=pt.selectedNode.extra;return Ee.dy`
    <strong>${e}</strong><br>
    <input data-name="${e}" .value=${t[e].value} @input=${ht._onAttributeChange} size="17">
    `},_renderOptions:()=>{let e=null;return null===pt.selection.type||(e=Ee.dy`
      <div class="Options">
        <button type="button" @click="${ht._onButtonDeleteClick}">❌ Delete</button>
      </div>
      `),e},update:()=>{ht._render()},_listenerNodeChanges:({action:e,payload:t})=>{switch(e){case"update":"node"===pt.selection.type&&pt.selection.id===t.id&&ht.update()}},_listenerSelectionChanges:({action:e,payload:t})=>{switch(e){case"select":pt.selection=t,ht._manageNewSelection();break;case"selectNONE":pt.selection={type:null,id:null},pt.selectedNode=null,pt.selectedNodeINRender=null}ht.update()},_manageNewSelection:()=>{const{selection:e}=pt;switch(e.type){case"node":ht._selectNode()}},_selectNode:()=>{pt.selectedNode=Ke.nodes.get({id:pt.selection.id}),pt.selectedNodeINRender=Ke.diagramRenderer.getNode({id:pt.selection.id})},_onAttributeChange:e=>{const t=e.target.dataset.name;pt.selectedNode.extra.attributes[t].value=e.target.value},_onButtonDeleteClick:e=>{pt.modalDelete.open()},_onButtonConfirmDeleteClick:e=>{switch(pt.modalDelete.close(),pt.selection.type){case"node":Ke.nodes.delete({id:pt.selection.id});break;case"connection":Ke.connections.delete({id:pt.selection.id})}}},ft=ht,mt={myDIV:null,zoneUP:{layer:null,choice:"outline",component:null},zoneDOWN:{layer:null,choice:"properties",component:null}},yt={_env:mt,init:()=>{mt.myDIV=document.createElement("div"),mt.myDIV.classList.add("sidebar-diagram"),it.init(),ct.init(),ft.init(),yt.update(),mt.zoneUP.layer=mt.myDIV.querySelector("div.zone-up"),mt.zoneDOWN.layer=mt.myDIV.querySelector("div.zone-down"),yt._changeZoneContent({choice:mt.zoneUP.choice}),yt._changeZoneContent({choice:mt.zoneDOWN.choice})},getComponent:()=>mt.myDIV,_render:()=>{const e=Ee.dy`
      <div class="selector" data-zone="up">
        <div class="choice" data-name="outline" @click="${yt._onClickChoice}">Ou</div>
        <div class="choice" data-name="palette" @click="${yt._onClickChoice}">Pa</div>
      </div>
      <div class="zone-up"></div>
      <div class="selector" data-zone="down">
        <div class="choice" data-name="properties" @click="${yt._onClickChoice}">Pr</div>
      </div>
      <div class="zone-down"></div>
    `;(0,Ee.sY)(e,mt.myDIV)},update:()=>{null!==mt.zoneUP.component&&mt.zoneUP.component.update(),null!==mt.zoneDOWN.component&&mt.zoneDOWN.component.update(),yt._render(),yt._paintChoices()},_paintChoices:()=>{mt.myDIV.querySelectorAll("div.selector > div.choice").forEach((e=>{e.classList.remove("selected")})),mt.myDIV.querySelector(`div.selector[data-zone="up"] div.choice[data-name="${mt.zoneUP.choice}"]`).classList.add("selected"),mt.myDIV.querySelector(`div.selector[data-zone="down"] div.choice[data-name="${mt.zoneDOWN.choice}"]`).classList.add("selected")},_onClickChoice:e=>{const t=e.target.getAttribute("data-name");yt._changeZoneContent({choice:t})},_changeZoneContent:({choice:e})=>{switch(e){case"outline":mt.zoneUP.layer.innerHTML="",mt.zoneUP.layer.appendChild(ct.getComponent()),mt.zoneUP.component=ct,mt.zoneUP.choice=e;break;case"palette":mt.zoneUP.layer.innerHTML="",mt.zoneUP.layer.appendChild(it.getComponent()),mt.zoneUP.component=it,mt.zoneUP.choice=e;break;case"properties":mt.zoneDOWN.layer.innerHTML="",mt.zoneDOWN.layer.appendChild(ft.getComponent()),mt.zoneDOWN.component=ft,mt.zoneDOWN.choice=e}yt.update()}},gt=yt,bt={myDIV:null,states:null,references:null},vt={_env:bt,init:()=>{bt.myDIV=document.createElement("div"),bt.myDIV.classList.add("states-list"),bt.states=ve.getStates(),bt.references=ve.getReferences(),ve.listenChanges({listener:vt._listenStateChanges})},getComponent:()=>bt.myDIV,_render:()=>{const e=Ee.dy`
      <strong>States list</strong><br>
      ${Object.values(bt.states).map((e=>vt._renderState({state:e})))}
    `;(0,Ee.sY)(e,bt.myDIV)},_renderState:({state:e})=>Ee.dy`
      <div class="state" data-id="${e.id}">
        <button @click=${vt._onClickButtonState}>📄 ${e.id}</button>
      </div>
    `,update:()=>{vt._render(),vt._updateSelected()},_updateSelected:()=>{bt.myDIV.querySelectorAll("div.state button").forEach((e=>{e.classList.remove("selected")})),null!==ve.getSelectedState()&&(console.log("Update selected",{selected:ve.getSelectedState()}),bt.myDIV.querySelector(`div.state[data-id="${ve.getSelectedState().id}"] button`).classList.add("selected"))},_listenStateChanges:e=>{vt.update()},_onClickButtonState:e=>{const t=e.target.parentElement.getAttribute("data-id");I.changeView({urlView:`data/state/${t}/edit/`})}},_t=vt,wt={myDIV:null,zoneUP:{layer:null,choice:"states-list",component:null},zoneDOWN:{layer:null,choice:"states-refs",component:null}},Et={_env:wt,init:()=>{wt.myDIV=document.createElement("div"),wt.myDIV.classList.add("sidebar-state-editor"),_t.init(),Et.update(),wt.zoneUP.layer=wt.myDIV.querySelector("div.zone-up"),wt.zoneDOWN.layer=wt.myDIV.querySelector("div.zone-down"),Et._changeZoneContent({choice:wt.zoneUP.choice}),Et._changeZoneContent({choice:wt.zoneDOWN.choice})},getComponent:()=>wt.myDIV,_render:()=>{const e=Ee.dy`
      <div class="selector" data-zone="up">
        <div class="choice" data-name="states-list" @click="${Et._onClickChoice}">St</div>
      </div>
      <div class="zone-up"></div>
      <div class="selector" data-zone="down">
        <div class="choice" data-name="states-refs" @click="${Et._onClickChoice}">Pr</div>
      </div>
      <div class="zone-down"></div>
    `;(0,Ee.sY)(e,wt.myDIV)},update:()=>{null!==wt.zoneUP.component&&wt.zoneUP.component.update(),null!==wt.zoneDOWN.component&&wt.zoneDOWN.component.update(),Et._render(),Et._paintChoices()},_paintChoices:()=>{wt.myDIV.querySelectorAll("div.selector > div.choice").forEach((e=>{e.classList.remove("selected")})),wt.myDIV.querySelector(`div.selector[data-zone="up"] div.choice[data-name="${wt.zoneUP.choice}"]`).classList.add("selected"),wt.myDIV.querySelector(`div.selector[data-zone="down"] div.choice[data-name="${wt.zoneDOWN.choice}"]`).classList.add("selected")},_onClickChoice:e=>{const t=e.target.getAttribute("data-name");Et._changeZoneContent({choice:t})},_changeZoneContent:({choice:e})=>{switch(e){case"states-list":wt.zoneUP.layer.innerHTML="",wt.zoneUP.layer.appendChild(_t.getComponent()),wt.zoneUP.component=_t,wt.zoneUP.choice=e;break;case"states-refs":wt.zoneDOWN.layer.innerHTML="",wt.zoneDOWN.choice=e}Et.update()}},Ct=Et,Tt={myDIV:null},Dt={_env:Tt,init:()=>{Tt.myDIV=document.createElement("div"),Tt.myDIV.classList.add("sidebar"),gt.init(),Ct.init(),I.listenLocationChanges({listener:Dt._onLocationChanges})},getComponent:()=>Tt.myDIV,_render:()=>{const{title:e}=I.getLocation();let t=null;switch(e){case"diagram":t=gt.getComponent();break;case"state-editor":t=Ct.getComponent()}const n=Ee.dy`
      ${t}
    `;(0,Ee.sY)(n,Tt.myDIV)},update:()=>{gt.update(),Ct.update(),Dt._render()},_onLocationChanges(e){Dt.update()}},St=Dt,At={_env:{myDIV:null},init:()=>{const{_env:e}=At;e.myDIV=document.createElement("div"),e.myDIV.classList.add("main")},getComponent(){const{_env:e}=At;return e.myDIV},_render:()=>{const{_env:e}=At,t=Ee.dy`<h1>Main</h1>`;(0,Ee.sY)(t,e.myDIV)},update:()=>{At._render()}},Ot=At,Nt={_env:{initialized:!1,layouts:{},bodyContainer:null,mainContainer:null},init:()=>{const{_env:e}=Nt;!0!==e.initialized&&(e.bodyContainer=document.createElement("div"),e.bodyContainer.classList.add("bodyContainer"),document.body.appendChild(e.bodyContainer),tt.init(),e.bodyContainer.appendChild(tt.getComponent()),e.layouts.header=tt,e.mainContainer=document.createElement("div"),e.mainContainer.classList.add("mainContainer"),e.bodyContainer.appendChild(e.mainContainer),St.init(),e.mainContainer.appendChild(St.getComponent()),e.layouts.sidebar=St,Ot.init(),e.mainContainer.appendChild(Ot.getComponent()),e.layouts.main=Ot,e.initialized=!0)},getLayouts:()=>Nt._env.layouts,render:()=>{tt.update(),St.update(),Ot.update()}},xt=Nt;function Pt(e){return e=e||[],Array.isArray(e)?e:[e]}function It(e){return`[Vaadin.Router] ${e}`}const jt="module",Lt="nomodule",Mt=[jt,Lt];function kt(e){if(!e.match(/.+\.[m]?js$/))throw new Error(It(`Unsupported type for bundle "${e}": .js or .mjs expected.`))}function Rt(e){if(!e||!$t(e.path))throw new Error(It('Expected route config to be an object with a "path" string property, or an array of such objects'));const t=e.bundle,n=["component","redirect","bundle"];if(!(Ft(e.action)||Array.isArray(e.children)||Ft(e.children)||Bt(t)||n.some((t=>$t(e[t])))))throw new Error(It(`Expected route config "${e.path}" to include either "${n.join('", "')}" or "action" function but none found.`));if(t)if($t(t))kt(t);else{if(!Mt.some((e=>e in t)))throw new Error(It('Expected route bundle to include either "nomodule" or "module" keys, or both'));Mt.forEach((e=>e in t&&kt(t[e])))}e.redirect&&["bundle","component"].forEach((t=>{t in e&&console.warn(It(`Route config "${e.path}" has both "redirect" and "${t}" properties, and "redirect" will always override the latter. Did you mean to only use "${t}"?`))}))}function Vt(e){Pt(e).forEach((e=>Rt(e)))}function Ut(e,t){let n=document.head.querySelector('script[src="'+e+'"][async]');return n||(n=document.createElement("script"),n.setAttribute("src",e),t===jt?n.setAttribute("type",jt):t===Lt&&n.setAttribute(Lt,""),n.async=!0),new Promise(((e,t)=>{n.onreadystatechange=n.onload=t=>{n.__dynamicImportLoaded=!0,e(t)},n.onerror=e=>{n.parentNode&&n.parentNode.removeChild(n),t(e)},null===n.parentNode?document.head.appendChild(n):n.__dynamicImportLoaded&&e()}))}function zt(e,t){return!window.dispatchEvent(new CustomEvent(`vaadin-router-${e}`,{cancelable:"go"===e,detail:t}))}function Bt(e){return"object"==typeof e&&!!e}function Ft(e){return"function"==typeof e}function $t(e){return"string"==typeof e}function Ht(e){const t=new Error(It(`Page not found (${e.pathname})`));return t.context=e,t.code=404,t}const Wt=new class{};function Yt(e){if(e.defaultPrevented)return;if(0!==e.button)return;if(e.shiftKey||e.ctrlKey||e.altKey||e.metaKey)return;let t=e.target;const n=e.composedPath?e.composedPath():e.path||[];for(let e=0;e<n.length;e++){const o=n[e];if(o.nodeName&&"a"===o.nodeName.toLowerCase()){t=o;break}}for(;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;if(!t||"a"!==t.nodeName.toLowerCase())return;if(t.target&&"_self"!==t.target.toLowerCase())return;if(t.hasAttribute("download"))return;if(t.hasAttribute("router-ignore"))return;if(t.pathname===window.location.pathname&&""!==t.hash)return;if((t.origin||function(e){const t=e.port,n=e.protocol;return`${n}//${"http:"===n&&"80"===t||"https:"===n&&"443"===t?e.hostname:e.host}`}(t))!==window.location.origin)return;const{pathname:o,search:r,hash:i}=t;zt("go",{pathname:o,search:r,hash:i})&&e.preventDefault()}const Gt={activate(){window.document.addEventListener("click",Yt)},inactivate(){window.document.removeEventListener("click",Yt)}};function qt(e){if("vaadin-router-ignore"===e.state)return;const{pathname:t,search:n,hash:o}=window.location;zt("go",{pathname:t,search:n,hash:o})}/Trident/.test(navigator.userAgent)&&!Ft(window.PopStateEvent)&&(window.PopStateEvent=function(e,t){t=t||{};var n=document.createEvent("Event");return n.initEvent(e,Boolean(t.bubbles),Boolean(t.cancelable)),n.state=t.state||null,n},window.PopStateEvent.prototype=window.Event.prototype);const Xt={activate(){window.addEventListener("popstate",qt)},inactivate(){window.removeEventListener("popstate",qt)}};var Zt=function e(t,n,o){return t instanceof RegExp?function(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var o=0;o<n.length;o++)t.push({name:o,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}(t,n):Array.isArray(t)?function(t,n,o){for(var r=[],i=0;i<t.length;i++)r.push(e(t[i],n,o).source);return new RegExp("(?:"+r.join("|")+")",an(o))}(t,n,o):function(e,t,n){return sn(tn(e,n),t,n)}(t,n,o)},Kt=tn,Jt=nn,Qt=sn,en=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function tn(e,t){for(var n,o=[],r=0,i=0,a="",s=t&&t.delimiter||"/",c=t&&t.delimiters||"./",l=!1;null!==(n=en.exec(e));){var d=n[0],u=n[1],p=n.index;if(a+=e.slice(i,p),i=p+d.length,u)a+=u[1],l=!0;else{var h="",f=e[i],m=n[2],y=n[3],g=n[4],b=n[5];if(!l&&a.length){var v=a.length-1;c.indexOf(a[v])>-1&&(h=a[v],a=a.slice(0,v))}a&&(o.push(a),a="",l=!1);var _=""!==h&&void 0!==f&&f!==h,w="+"===b||"*"===b,E="?"===b||"*"===b,C=h||s,T=y||g;o.push({name:m||r++,prefix:h,delimiter:C,optional:E,repeat:w,partial:_,pattern:T?rn(T):"[^"+on(C)+"]+?"})}}return(a||i<e.length)&&o.push(a+e.substr(i)),o}function nn(e){for(var t=new Array(e.length),n=0;n<e.length;n++)"object"==typeof e[n]&&(t[n]=new RegExp("^(?:"+e[n].pattern+")$"));return function(n,o){for(var r="",i=o&&o.encode||encodeURIComponent,a=0;a<e.length;a++){var s=e[a];if("string"!=typeof s){var c,l=n?n[s.name]:void 0;if(Array.isArray(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but got array');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var d=0;d<l.length;d++){if(c=i(l[d],s),!t[a].test(c))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'"');r+=(0===d?s.prefix:s.delimiter)+c}}else if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l){if(!s.optional)throw new TypeError('Expected "'+s.name+'" to be '+(s.repeat?"an array":"a string"));s.partial&&(r+=s.prefix)}else{if(c=i(String(l),s),!t[a].test(c))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but got "'+c+'"');r+=s.prefix+c}}else r+=s}return r}}function on(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function rn(e){return e.replace(/([=!:$/()])/g,"\\$1")}function an(e){return e&&e.sensitive?"":"i"}function sn(e,t,n){for(var o=(n=n||{}).strict,r=!1!==n.start,i=!1!==n.end,a=on(n.delimiter||"/"),s=n.delimiters||"./",c=[].concat(n.endsWith||[]).map(on).concat("$").join("|"),l=r?"^":"",d=0===e.length,u=0;u<e.length;u++){var p=e[u];if("string"==typeof p)l+=on(p),d=u===e.length-1&&s.indexOf(p[p.length-1])>-1;else{var h=p.repeat?"(?:"+p.pattern+")(?:"+on(p.delimiter)+"(?:"+p.pattern+"))*":p.pattern;t&&t.push(p),p.optional?p.partial?l+=on(p.prefix)+"("+h+")?":l+="(?:"+on(p.prefix)+"("+h+"))?":l+=on(p.prefix)+"("+h+")"}}return i?(o||(l+="(?:"+a+")?"),l+="$"===c?"$":"(?="+c+")"):(o||(l+="(?:"+a+"(?="+c+"))?"),d||(l+="(?="+a+"|"+c+")")),new RegExp(l,an(n))}Zt.parse=Kt,Zt.compile=function(e,t){return nn(tn(e,t))},Zt.tokensToFunction=Jt,Zt.tokensToRegExp=Qt;const{hasOwnProperty:cn}=Object.prototype,ln=new Map;function dn(e){try{return decodeURIComponent(e)}catch(t){return e}}function un(e,t,n,o,r){let i,a,s=0,c=e.path||"";return"/"===c.charAt(0)&&(n&&(c=c.substr(1)),n=!0),{next(l){if(e===l)return{done:!0};const d=e.__children=e.__children||e.children;if(!i&&(i=function(e,t,n,o,r){const i=`${e}|${n=!!n}`;let a=ln.get(i);if(!a){const t=[];a={keys:t,pattern:Zt(e,t,{end:n,strict:""===e})},ln.set(i,a)}const s=a.pattern.exec(t);if(!s)return null;const c=Object.assign({},r);for(let e=1;e<s.length;e++){const t=a.keys[e-1],n=t.name,o=s[e];void 0===o&&cn.call(c,n)||(t.repeat?c[n]=o?o.split(t.delimiter).map(dn):[]:c[n]=o?dn(o):o)}return{path:s[0],keys:(o||[]).concat(a.keys),params:c}}(c,t,!d,o,r),i))return{done:!1,value:{route:e,keys:i.keys,params:i.params,path:i.path}};if(i&&d)for(;s<d.length;){if(!a){const o=d[s];o.parent=e;let r=i.path.length;r>0&&"/"===t.charAt(r)&&(r+=1),a=un(o,t.substr(r),n,i.keys,i.params)}const o=a.next(l);if(!o.done)return{done:!1,value:o.value};a=null,s++}return{done:!0}}}}function pn(e){if(Ft(e.route.action))return e.route.action(e)}ln.set("|false",{keys:[],pattern:/(?:)/});class hn{constructor(e,t={}){if(Object(e)!==e)throw new TypeError("Invalid routes");this.baseUrl=t.baseUrl||"",this.errorHandler=t.errorHandler,this.resolveRoute=t.resolveRoute||pn,this.context=Object.assign({resolver:this},t.context),this.root=Array.isArray(e)?{path:"",__children:e,parent:null,__synthetic:!0}:e,this.root.parent=null}getRoutes(){return[...this.root.__children]}setRoutes(e){Vt(e);const t=[...Pt(e)];this.root.__children=t}addRoutes(e){return Vt(e),this.root.__children.push(...Pt(e)),this.getRoutes()}removeRoutes(){this.setRoutes([])}resolve(e){const t=Object.assign({},this.context,$t(e)?{pathname:e}:e),n=un(this.root,this.__normalizePathname(t.pathname),this.baseUrl),o=this.resolveRoute;let r=null,i=null,a=t;function s(e,c=r.value.route,l){const d=null===l&&r.value.route;return r=i||n.next(d),i=null,e||!r.done&&function(e,t){let n=t;for(;n;)if(n=n.parent,n===e)return!0;return!1}(c,r.value.route)?r.done?Promise.reject(Ht(t)):(a=Object.assign(a?{chain:a.chain?a.chain.slice(0):[]}:{},t,r.value),function(e,t){const{route:n,path:o}=t;if(n&&!n.__synthetic){const t={path:o,route:n};if(e.chain){if(n.parent){let t=e.chain.length;for(;t--&&e.chain[t].route&&e.chain[t].route!==n.parent;)e.chain.pop()}}else e.chain=[];e.chain.push(t)}}(a,r.value),Promise.resolve(o(a)).then((t=>null!=t&&t!==Wt?(a.result=t.result||t,a):s(e,c,t)))):(i=r,Promise.resolve(Wt))}return t.next=s,Promise.resolve().then((()=>s(!0,this.root))).catch((e=>{const t=function(e){let t=`Path '${e.pathname}' is not properly resolved due to an error.`;const n=(e.route||{}).path;return n&&(t+=` Resolution had failed on route: '${n}'`),t}(a);if(e?console.warn(t):e=new Error(t),e.context=e.context||a,e instanceof DOMException||(e.code=e.code||500),this.errorHandler)return a.result=this.errorHandler(e),a;throw e}))}static __createUrl(e,t){return new URL(e,t)}get __effectiveBaseUrl(){return this.baseUrl?this.constructor.__createUrl(this.baseUrl,document.baseURI||document.URL).href.replace(/[^\/]*$/,""):""}__normalizePathname(e){if(!this.baseUrl)return e;const t=this.__effectiveBaseUrl,n=this.constructor.__createUrl(e,t).href;return n.slice(0,t.length)===t?n.slice(t.length):void 0}}hn.pathToRegexp=Zt;const{pathToRegexp:fn}=hn,mn=new Map;function yn(e,t,n){const o=t.name||t.component;if(o&&(e.has(o)?e.get(o).push(t):e.set(o,[t])),Array.isArray(n))for(let o=0;o<n.length;o++){const r=n[o];r.parent=t,yn(e,r,r.__children||r.children)}}function gn(e,t){const n=e.get(t);if(n&&n.length>1)throw new Error(`Duplicate route with name "${t}". Try seting unique 'name' route properties.`);return n&&n[0]}function bn(e){let t=e.path;return t=Array.isArray(t)?t[0]:t,void 0!==t?t:""}function vn(e,t={}){if(!(e instanceof hn))throw new TypeError("An instance of Resolver is expected");const n=new Map;return(o,r)=>{let i=gn(n,o);if(!i&&(n.clear(),yn(n,e.root,e.root.__children),i=gn(n,o),!i))throw new Error(`Route "${o}" not found`);let a=mn.get(i.fullPath);if(!a){let e=bn(i),t=i.parent;for(;t;){const n=bn(t);n&&(e=n.replace(/\/$/,"")+"/"+e.replace(/^\//,"")),t=t.parent}const n=fn.parse(e),o=fn.tokensToFunction(n),r=Object.create(null);for(let e=0;e<n.length;e++)$t(n[e])||(r[n[e].name]=!0);a={toPath:o,keys:r},mn.set(e,a),i.fullPath=e}let s=a.toPath(r,t)||"/";if(t.stringifyQueryParams&&r){const e={},n=Object.keys(r);for(let t=0;t<n.length;t++){const o=n[t];a.keys[o]||(e[o]=r[o])}const o=t.stringifyQueryParams(e);o&&(s+="?"===o.charAt(0)?o:`?${o}`)}return s}}let _n=[];function wn(e){_n.forEach((e=>e.inactivate())),e.forEach((e=>e.activate())),_n=e}function En(e,t){return e.classList.add(t),new Promise((n=>{if((e=>{const t=getComputedStyle(e).getPropertyValue("animation-name");return t&&"none"!==t})(e)){const o=e.getBoundingClientRect(),r=`height: ${o.bottom-o.top}px; width: ${o.right-o.left}px`;e.setAttribute("style",`position: absolute; ${r}`),((e,t)=>{const n=()=>{e.removeEventListener("animationend",n),t()};e.addEventListener("animationend",n)})(e,(()=>{e.classList.remove(t),e.removeAttribute("style"),n()}))}else e.classList.remove(t),n()}))}function Cn(e){return null!=e}function Tn({pathname:e="",search:t="",hash:n="",chain:o=[],params:r={},redirectFrom:i,resolver:a},s){const c=o.map((e=>e.route));return{baseUrl:a&&a.baseUrl||"",pathname:e,search:t,hash:n,routes:c,route:s||c.length&&c[c.length-1]||null,params:r,redirectFrom:i,getUrl:(e={})=>Nn(Pn.pathToRegexp.compile(xn(c))(Object.assign({},r,e)),a)}}function Dn(e,t){const n=Object.assign({},e.params);return{redirect:{pathname:t,from:e.pathname,params:n}}}function Sn(e,t,n){if(Ft(e))return e.apply(n,t)}function An(e,t,n){return o=>o&&(o.cancel||o.redirect)?o:n?Sn(n[e],t,n):void 0}function On(e){if(e&&e.length){const t=e[0].parentNode;for(let n=0;n<e.length;n++)t.removeChild(e[n])}}function Nn(e,t){const n=t.__effectiveBaseUrl;return n?t.constructor.__createUrl(e.replace(/^\//,""),n).pathname:e}function xn(e){return e.map((e=>e.path)).reduce(((e,t)=>t.length?e.replace(/\/$/,"")+"/"+t.replace(/^\//,""):e),"")}class Pn extends hn{constructor(e,t){const n=document.head.querySelector("base"),o=n&&n.getAttribute("href");super([],Object.assign({baseUrl:o&&hn.__createUrl(o,document.URL).pathname.replace(/[^\/]*$/,"")},t)),this.resolveRoute=e=>this.__resolveRoute(e);const r=Pn.NavigationTrigger;Pn.setTriggers.apply(Pn,Object.keys(r).map((e=>r[e]))),this.baseUrl,this.ready,this.ready=Promise.resolve(e),this.location,this.location=Tn({resolver:this}),this.__lastStartedRenderId=0,this.__navigationEventHandler=this.__onNavigationEvent.bind(this),this.setOutlet(e),this.subscribe(),this.__createdByRouter=new WeakMap,this.__addedByRouter=new WeakMap}__resolveRoute(e){const t=e.route;let n=Promise.resolve();Ft(t.children)&&(n=n.then((()=>t.children(function(e){const t=Object.assign({},e);return delete t.next,t}(e)))).then((e=>{Cn(e)||Ft(t.children)||(e=t.children),function(e,t){if(!Array.isArray(e)&&!Bt(e))throw new Error(It(`Incorrect "children" value for the route ${t.path}: expected array or object, but got ${e}`));t.__children=[];const n=Pt(e);for(let e=0;e<n.length;e++)Rt(n[e]),t.__children.push(n[e])}(e,t)})));const o={redirect:t=>Dn(e,t),component:e=>{const t=document.createElement(e);return this.__createdByRouter.set(t,!0),t}};return n.then((()=>{if(this.__isLatestRender(e))return Sn(t.action,[e,o],t)})).then((e=>{return Cn(e)&&(e instanceof HTMLElement||e.redirect||e===Wt)?e:$t(t.redirect)?o.redirect(t.redirect):t.bundle?(n=t.bundle,$t(n)?Ut(n):Promise.race(Mt.filter((e=>e in n)).map((e=>Ut(n[e],e))))).then((()=>{}),(()=>{throw new Error(It(`Bundle not found: ${t.bundle}. Check if the file name is correct`))})):void 0;var n})).then((e=>Cn(e)?e:$t(t.component)?o.component(t.component):void 0))}setOutlet(e){e&&this.__ensureOutlet(e),this.__outlet=e}getOutlet(){return this.__outlet}setRoutes(e,t=!1){return this.__previousContext=void 0,this.__urlForName=void 0,super.setRoutes(e),t||this.__onNavigationEvent(),this.ready}render(e,t){const n=++this.__lastStartedRenderId,o=Object.assign({search:"",hash:""},$t(e)?{pathname:e}:e,{__renderId:n});return this.ready=this.resolve(o).then((e=>this.__fullyResolveChain(e))).then((e=>{if(this.__isLatestRender(e)){const o=this.__previousContext;if(e===o)return this.__updateBrowserHistory(o,!0),this.location;if(this.location=Tn(e),t&&this.__updateBrowserHistory(e,1===n),zt("location-changed",{router:this,location:this.location}),e.__skipAttach)return this.__copyUnchangedElements(e,o),this.__previousContext=e,this.location;this.__addAppearingContent(e,o);const r=this.__animateIfNeeded(e);return this.__runOnAfterEnterCallbacks(e),this.__runOnAfterLeaveCallbacks(e,o),r.then((()=>{if(this.__isLatestRender(e))return this.__removeDisappearingContent(),this.__previousContext=e,this.location}))}})).catch((e=>{if(n===this.__lastStartedRenderId)throw t&&this.__updateBrowserHistory(o),On(this.__outlet&&this.__outlet.children),this.location=Tn(Object.assign(o,{resolver:this})),zt("error",Object.assign({router:this,error:e},o)),e})),this.ready}__fullyResolveChain(e,t=e){return this.__findComponentContextAfterAllRedirects(t).then((n=>{const o=n!==t?n:e,r=Nn(xn(n.chain),n.resolver)===n.pathname,i=(e,t=e.route,n)=>e.next(void 0,t,n).then((n=>null===n||n===Wt?r?e:null!==t.parent?i(e,t.parent,n):n:n));return i(n).then((e=>{if(null===e||e===Wt)throw Ht(o);return e&&e!==Wt&&e!==n?this.__fullyResolveChain(o,e):this.__amendWithOnBeforeCallbacks(n)}))}))}__findComponentContextAfterAllRedirects(e){const t=e.result;return t instanceof HTMLElement?(function(e,t){t.location=Tn(e);const n=e.chain.map((e=>e.route)).indexOf(e.route);e.chain[n].element=t}(e,t),Promise.resolve(e)):t.redirect?this.__redirect(t.redirect,e.__redirectCount,e.__renderId).then((e=>this.__findComponentContextAfterAllRedirects(e))):t instanceof Error?Promise.reject(t):Promise.reject(new Error(It(`Invalid route resolution result for path "${e.pathname}". Expected redirect object or HTML element, but got: "${function(e){if("object"!=typeof e)return String(e);const t=Object.prototype.toString.call(e).match(/ (.*)\]$/)[1];return"Object"===t||"Array"===t?`${t} ${JSON.stringify(e)}`:t}(t)}". Double check the action return value for the route.`)))}__amendWithOnBeforeCallbacks(e){return this.__runOnBeforeCallbacks(e).then((t=>t===this.__previousContext||t===e?t:this.__fullyResolveChain(t)))}__runOnBeforeCallbacks(e){const t=this.__previousContext||{},n=t.chain||[],o=e.chain;let r=Promise.resolve();const i=()=>({cancel:!0}),a=t=>Dn(e,t);if(e.__divergedChainIndex=0,e.__skipAttach=!1,n.length){for(let t=0;t<Math.min(n.length,o.length)&&n[t].route===o[t].route&&(n[t].path===o[t].path||n[t].element===o[t].element)&&this.__isReusableElement(n[t].element,o[t].element);t=++e.__divergedChainIndex);if(e.__skipAttach=o.length===n.length&&e.__divergedChainIndex==o.length&&this.__isReusableElement(e.result,t.result),e.__skipAttach){for(let t=o.length-1;t>=0;t--)r=this.__runOnBeforeLeaveCallbacks(r,e,{prevent:i},n[t]);for(let t=0;t<o.length;t++)r=this.__runOnBeforeEnterCallbacks(r,e,{prevent:i,redirect:a},o[t]),n[t].element.location=Tn(e,n[t].route)}else for(let t=n.length-1;t>=e.__divergedChainIndex;t--)r=this.__runOnBeforeLeaveCallbacks(r,e,{prevent:i},n[t])}if(!e.__skipAttach)for(let t=0;t<o.length;t++)t<e.__divergedChainIndex?t<n.length&&n[t].element&&(n[t].element.location=Tn(e,n[t].route)):(r=this.__runOnBeforeEnterCallbacks(r,e,{prevent:i,redirect:a},o[t]),o[t].element&&(o[t].element.location=Tn(e,o[t].route)));return r.then((t=>{if(t){if(t.cancel)return this.__previousContext.__renderId=e.__renderId,this.__previousContext;if(t.redirect)return this.__redirect(t.redirect,e.__redirectCount,e.__renderId)}return e}))}__runOnBeforeLeaveCallbacks(e,t,n,o){const r=Tn(t);return e.then((e=>{if(this.__isLatestRender(t))return An("onBeforeLeave",[r,n,this],o.element)(e)})).then((e=>{if(!(e||{}).redirect)return e}))}__runOnBeforeEnterCallbacks(e,t,n,o){const r=Tn(t,o.route);return e.then((e=>{if(this.__isLatestRender(t))return An("onBeforeEnter",[r,n,this],o.element)(e)}))}__isReusableElement(e,t){return!(!e||!t)&&(this.__createdByRouter.get(e)&&this.__createdByRouter.get(t)?e.localName===t.localName:e===t)}__isLatestRender(e){return e.__renderId===this.__lastStartedRenderId}__redirect(e,t,n){if(t>256)throw new Error(It(`Too many redirects when rendering ${e.from}`));return this.resolve({pathname:this.urlForPath(e.pathname,e.params),redirectFrom:e.from,__redirectCount:(t||0)+1,__renderId:n})}__ensureOutlet(e=this.__outlet){if(!(e instanceof Node))throw new TypeError(It(`Expected router outlet to be a valid DOM Node (but got ${e})`))}__updateBrowserHistory({pathname:e,search:t="",hash:n=""},o){if(window.location.pathname!==e||window.location.search!==t||window.location.hash!==n){const r=o?"replaceState":"pushState";window.history[r](null,document.title,e+t+n),window.dispatchEvent(new PopStateEvent("popstate",{state:"vaadin-router-ignore"}))}}__copyUnchangedElements(e,t){let n=this.__outlet;for(let o=0;o<e.__divergedChainIndex;o++){const r=t&&t.chain[o].element;if(r){if(r.parentNode!==n)break;e.chain[o].element=r,n=r}}return n}__addAppearingContent(e,t){this.__ensureOutlet(),this.__removeAppearingContent();const n=this.__copyUnchangedElements(e,t);this.__appearingContent=[],this.__disappearingContent=Array.from(n.children).filter((t=>this.__addedByRouter.get(t)&&t!==e.result));let o=n;for(let t=e.__divergedChainIndex;t<e.chain.length;t++){const r=e.chain[t].element;r&&(o.appendChild(r),this.__addedByRouter.set(r,!0),o===n&&this.__appearingContent.push(r),o=r)}}__removeDisappearingContent(){this.__disappearingContent&&On(this.__disappearingContent),this.__disappearingContent=null,this.__appearingContent=null}__removeAppearingContent(){this.__disappearingContent&&this.__appearingContent&&(On(this.__appearingContent),this.__disappearingContent=null,this.__appearingContent=null)}__runOnAfterLeaveCallbacks(e,t){if(t)for(let n=t.chain.length-1;n>=e.__divergedChainIndex&&this.__isLatestRender(e);n--){const o=t.chain[n].element;if(o)try{const n=Tn(e);Sn(o.onAfterLeave,[n,{},t.resolver],o)}finally{this.__disappearingContent.indexOf(o)>-1&&On(o.children)}}}__runOnAfterEnterCallbacks(e){for(let t=e.__divergedChainIndex;t<e.chain.length&&this.__isLatestRender(e);t++){const n=e.chain[t].element||{},o=Tn(e,e.chain[t].route);Sn(n.onAfterEnter,[o,{},e.resolver],n)}}__animateIfNeeded(e){const t=(this.__disappearingContent||[])[0],n=(this.__appearingContent||[])[0],o=[],r=e.chain;let i;for(let e=r.length;e>0;e--)if(r[e-1].route.animate){i=r[e-1].route.animate;break}if(t&&n&&i){const e=Bt(i)&&i.leave||"leaving",r=Bt(i)&&i.enter||"entering";o.push(En(t,e)),o.push(En(n,r))}return Promise.all(o).then((()=>e))}subscribe(){window.addEventListener("vaadin-router-go",this.__navigationEventHandler)}unsubscribe(){window.removeEventListener("vaadin-router-go",this.__navigationEventHandler)}__onNavigationEvent(e){const{pathname:t,search:n,hash:o}=e?e.detail:window.location;$t(this.__normalizePathname(t))&&(e&&e.preventDefault&&e.preventDefault(),this.render({pathname:t,search:n,hash:o},!0))}static setTriggers(...e){wn(e)}urlForName(e,t){return this.__urlForName||(this.__urlForName=vn(this)),Nn(this.__urlForName(e,t),this)}urlForPath(e,t){return Nn(Pn.pathToRegexp.compile(e)(t),this)}static go(e){const{pathname:t,search:n,hash:o}=$t(e)?this.__createUrl(e,"http://a"):e;return zt("go",{pathname:t,search:n,hash:o})}}const In=/\/\*\*\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i,jn=window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients;function Ln(e,t){if("function"!=typeof e)return;const n=In.exec(e.toString());if(n)try{e=new Function(n[1])}catch(e){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",e)}return e(t)}window.Vaadin=window.Vaadin||{};void 0===window.Vaadin.developmentMode&&(window.Vaadin.developmentMode=function(){try{return!!localStorage.getItem("vaadin.developmentmode.force")||["localhost","127.0.0.1"].indexOf(window.location.hostname)>=0&&(jn?!(jn&&Object.keys(jn).map((e=>jn[e])).filter((e=>e.productionMode)).length>0):!Ln((function(){return!0})))}catch(e){return!1}}()),window.Vaadin=window.Vaadin||{},window.Vaadin.registrations=window.Vaadin.registrations||[],window.Vaadin.registrations.push({is:"@vaadin/router",version:"1.7.2"}),function(e,t){if(window.Vaadin.developmentMode)Ln(e,t)}((function(){})),Pn.NavigationTrigger={POPSTATE:Xt,CLICK:Gt};const Mn={type:"change"},kn={type:"start"},Rn={type:"end"};class Vn extends Ye.EventDispatcher{constructor(e,t){super(),void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Ye.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ye.MOUSE.ROTATE,MIDDLE:Ye.MOUSE.DOLLY,RIGHT:Ye.MOUSE.PAN},this.touches={ONE:Ye.TOUCH.ROTATE,TWO:Ye.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",$),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Mn),n.update(),r=o.NONE},this.update=function(){const t=new Ye.Vector3,u=(new Ye.Quaternion).setFromUnitVectors(e.up,new Ye.Vector3(0,1,0)),p=u.clone().invert(),h=new Ye.Vector3,f=new Ye.Quaternion,m=2*Math.PI;return function(){const e=n.object.position;t.copy(e).sub(n.target),t.applyQuaternion(u),a.setFromVector3(t),n.autoRotate&&r===o.NONE&&C(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(a.theta+=s.theta*n.dampingFactor,a.phi+=s.phi*n.dampingFactor):(a.theta+=s.theta,a.phi+=s.phi);let y=n.minAzimuthAngle,g=n.maxAzimuthAngle;return isFinite(y)&&isFinite(g)&&(y<-Math.PI?y+=m:y>Math.PI&&(y-=m),g<-Math.PI?g+=m:g>Math.PI&&(g-=m),a.theta=y<=g?Math.max(y,Math.min(g,a.theta)):a.theta>(y+g)/2?Math.max(y,a.theta):Math.min(g,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),!0===n.enableDamping?n.target.addScaledVector(l,n.dampingFactor):n.target.add(l),t.setFromSpherical(a),t.applyQuaternion(p),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(s.theta*=1-n.dampingFactor,s.phi*=1-n.dampingFactor,l.multiplyScalar(1-n.dampingFactor)):(s.set(0,0,0),l.set(0,0,0)),c=1,!!(d||h.distanceToSquared(n.object.position)>i||8*(1-f.dot(n.object.quaternion))>i)&&(n.dispatchEvent(Mn),h.copy(n.object.position),f.copy(n.object.quaternion),d=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",H),n.domElement.removeEventListener("pointerdown",V),n.domElement.removeEventListener("pointercancel",B),n.domElement.removeEventListener("wheel",F),n.domElement.removeEventListener("pointermove",U),n.domElement.removeEventListener("pointerup",z),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",$)};const n=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=o.NONE;const i=1e-6,a=new Ye.Spherical,s=new Ye.Spherical;let c=1;const l=new Ye.Vector3;let d=!1;const u=new Ye.Vector2,p=new Ye.Vector2,h=new Ye.Vector2,f=new Ye.Vector2,m=new Ye.Vector2,y=new Ye.Vector2,g=new Ye.Vector2,b=new Ye.Vector2,v=new Ye.Vector2,_=[],w={};function E(){return Math.pow(.95,n.zoomSpeed)}function C(e){s.theta-=e}function T(e){s.phi-=e}const D=function(){const e=new Ye.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),l.add(e)}}(),S=function(){const e=new Ye.Vector3;return function(t,o){!0===n.screenSpacePanning?e.setFromMatrixColumn(o,1):(e.setFromMatrixColumn(o,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),A=function(){const e=new Ye.Vector3;return function(t,o){const r=n.domElement;if(n.object.isPerspectiveCamera){const i=n.object.position;e.copy(i).sub(n.target);let a=e.length();a*=Math.tan(n.object.fov/2*Math.PI/180),D(2*t*a/r.clientHeight,n.object.matrix),S(2*o*a/r.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(D(t*(n.object.right-n.object.left)/n.object.zoom/r.clientWidth,n.object.matrix),S(o*(n.object.top-n.object.bottom)/n.object.zoom/r.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(e){n.object.isPerspectiveCamera?c/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function N(e){n.object.isPerspectiveCamera?c*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function x(e){u.set(e.clientX,e.clientY)}function P(e){f.set(e.clientX,e.clientY)}function I(){if(1===_.length)u.set(_[0].pageX,_[0].pageY);else{const e=.5*(_[0].pageX+_[1].pageX),t=.5*(_[0].pageY+_[1].pageY);u.set(e,t)}}function j(){if(1===_.length)f.set(_[0].pageX,_[0].pageY);else{const e=.5*(_[0].pageX+_[1].pageX),t=.5*(_[0].pageY+_[1].pageY);f.set(e,t)}}function L(){const e=_[0].pageX-_[1].pageX,t=_[0].pageY-_[1].pageY,n=Math.sqrt(e*e+t*t);g.set(0,n)}function M(e){if(1==_.length)p.set(e.pageX,e.pageY);else{const t=G(e),n=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);p.set(n,o)}h.subVectors(p,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(p)}function k(e){if(1===_.length)m.set(e.pageX,e.pageY);else{const t=G(e),n=.5*(e.pageX+t.x),o=.5*(e.pageY+t.y);m.set(n,o)}y.subVectors(m,f).multiplyScalar(n.panSpeed),A(y.x,y.y),f.copy(m)}function R(e){const t=G(e),o=e.pageX-t.x,r=e.pageY-t.y,i=Math.sqrt(o*o+r*r);b.set(0,i),v.set(0,Math.pow(b.y/g.y,n.zoomSpeed)),O(v.y),g.copy(b)}function V(e){!1!==n.enabled&&(0===_.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",U),n.domElement.addEventListener("pointerup",z)),function(e){_.push(e)}(e),"touch"===e.pointerType?function(e){switch(Y(e),_.length){case 1:switch(n.touches.ONE){case Ye.TOUCH.ROTATE:if(!1===n.enableRotate)return;I(),r=o.TOUCH_ROTATE;break;case Ye.TOUCH.PAN:if(!1===n.enablePan)return;j(),r=o.TOUCH_PAN;break;default:r=o.NONE}break;case 2:switch(n.touches.TWO){case Ye.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&L(),n.enablePan&&j(),r=o.TOUCH_DOLLY_PAN;break;case Ye.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&L(),n.enableRotate&&I(),r=o.TOUCH_DOLLY_ROTATE;break;default:r=o.NONE}break;default:r=o.NONE}r!==o.NONE&&n.dispatchEvent(kn)}(e):function(e){let t;switch(e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Ye.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){g.set(e.clientX,e.clientY)}(e),r=o.DOLLY;break;case Ye.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;P(e),r=o.PAN}else{if(!1===n.enableRotate)return;x(e),r=o.ROTATE}break;case Ye.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;x(e),r=o.ROTATE}else{if(!1===n.enablePan)return;P(e),r=o.PAN}break;default:r=o.NONE}r!==o.NONE&&n.dispatchEvent(kn)}(e))}function U(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(Y(e),r){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;M(e),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;k(e),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&R(e),n.enablePan&&k(e)}(e),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&R(e),n.enableRotate&&M(e)}(e),n.update();break;default:r=o.NONE}}(e):function(e){if(!1!==n.enabled)switch(r){case o.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),h.subVectors(p,u).multiplyScalar(n.rotateSpeed);const t=n.domElement;C(2*Math.PI*h.x/t.clientHeight),T(2*Math.PI*h.y/t.clientHeight),u.copy(p),n.update()}(e);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),v.subVectors(b,g),v.y>0?O(E()):v.y<0&&N(E()),g.copy(b),n.update()}(e);break;case o.PAN:if(!1===n.enablePan)return;!function(e){m.set(e.clientX,e.clientY),y.subVectors(m,f).multiplyScalar(n.panSpeed),A(y.x,y.y),f.copy(m),n.update()}(e)}}(e))}function z(e){W(e),0===_.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",U),n.domElement.removeEventListener("pointerup",z)),n.dispatchEvent(Rn),r=o.NONE}function B(e){W(e)}function F(e){!1!==n.enabled&&!1!==n.enableZoom&&r===o.NONE&&(e.preventDefault(),n.dispatchEvent(kn),function(e){e.deltaY<0?N(E()):e.deltaY>0&&O(E()),n.update()}(e),n.dispatchEvent(Rn))}function $(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:A(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:A(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:A(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:A(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function H(e){!1!==n.enabled&&e.preventDefault()}function W(e){delete w[e.pointerId];for(let t=0;t<_.length;t++)if(_[t].pointerId==e.pointerId)return void _.splice(t,1)}function Y(e){let t=w[e.pointerId];void 0===t&&(t=new Ye.Vector2,w[e.pointerId]=t),t.set(e.pageX,e.pageY)}function G(e){const t=e.pointerId===_[0].pointerId?_[1]:_[0];return w[t.pointerId]}n.domElement.addEventListener("contextmenu",H),n.domElement.addEventListener("pointerdown",V),n.domElement.addEventListener("pointercancel",B),n.domElement.addEventListener("wheel",F,{passive:!1}),this.update()}}const Un=new Ye.Plane,zn=new Ye.Raycaster,Bn=new Ye.Vector2,Fn=new Ye.Vector3,$n=new Ye.Vector3,Hn=new Ye.Vector3,Wn=new Ye.Matrix4;class Yn extends Ye.EventDispatcher{constructor(e,t,n){super(),n.style.touchAction="none";let o=null,r=null;const i=[];let a=!1;const s=this;function c(){n.addEventListener("pointermove",d),n.addEventListener("pointerdown",u),n.addEventListener("pointerup",p),n.addEventListener("pointerleave",p)}function l(){n.removeEventListener("pointermove",d),n.removeEventListener("pointerdown",u),n.removeEventListener("pointerup",p),n.removeEventListener("pointerleave",p),n.style.cursor=""}function d(c){if(!1!==s.enabled){if(h(c),zn.setFromCamera(Bn,t),o&&!1===a)return zn.ray.intersectPlane(Un,$n)&&o.position.copy($n.sub(Fn).applyMatrix4(Wn)),void s.dispatchEvent({type:"drag",object:o});if("mouse"===c.pointerType||"pen"===c.pointerType)if(i.length=0,zn.setFromCamera(Bn,t),zn.intersectObjects(e,!0,i),i.length>0){const e=i[0].object;Un.setFromNormalAndCoplanarPoint(t.getWorldDirection(Un.normal),Hn.setFromMatrixPosition(e.matrixWorld)),r!==e&&null!==r&&(s.dispatchEvent({type:"hoveroff",object:r}),n.style.cursor="auto",r=null),r!==e&&(s.dispatchEvent({type:"hoveron",object:e}),n.style.cursor="pointer",r=e)}else null!==r&&(s.dispatchEvent({type:"hoveroff",object:r}),n.style.cursor="auto",r=null)}}function u(r){!1!==s.enabled&&(h(r),i.length=0,zn.setFromCamera(Bn,t),zn.intersectObjects(e,!0,i),i.length>0&&(o=!0===s.transformGroup?e[0]:i[0].object,Un.setFromNormalAndCoplanarPoint(t.getWorldDirection(Un.normal),Hn.setFromMatrixPosition(o.matrixWorld)),zn.ray.intersectPlane(Un,$n)&&(Wn.copy(o.parent.matrixWorld).invert(),Fn.copy($n).sub(Hn.setFromMatrixPosition(o.matrixWorld))),n.style.cursor="move",s.dispatchEvent({type:"dragstart",object:o})))}function p(){!1!==s.enabled&&(o&&(s.dispatchEvent({type:"dragend",object:o}),o=null,a=!1),n.style.cursor=r?"pointer":"auto")}function h(e){const t=n.getBoundingClientRect();Bn.x=(e.clientX-t.left)/t.width*2-1,Bn.y=-(e.clientY-t.top)/t.height*2+1}c(),this.enabled=!0,this.transformGroup=!1,this.activate=c,this.deactivate=l,this.dispose=function(){l()},this.getObjects=function(){return e},this.getRaycaster=function(){return zn},this.nonDraggable=function(){a=!0}}}const Gn={diagramManager:null,diagramHandler:null,node:null,nodeConnections:null},qn={_env:Gn,init:({diagramHandler:e})=>{const{_env:t}=e,{diagram:n,overObject:o}=t;Gn.diagramManager=n._env.manager,Gn.diagramHandler=e,t.draggableTypes.NODE_BODY="node-body"},_dragNode:e=>{if(!0===e.dragStart){const{diagramHandler:e,diagramManager:t}=Gn,{diagram:n,overObject:o}=e._env;Gn.node=t.nodes.get({id:o.parent.userData.id}),Gn.nodeConnections=n.getConnections({nodeID:Gn.node.id}),e.selection.select({type:"node",id:o.parent.userData.id,object:o.parent.userData})}else if(!0===e.dragEnd){const{diagramManager:e}=Gn,t=e.diagramRenderer.getNode({id:Gn.node.id});Gn.node.extra.position.x=t.model.position.x,Gn.node.extra.position.y=t.model.position.y,Gn.node.extra.position.z=t.model.position.z,e.nodes.update({node:Gn.node}),Gn.node=null,Gn.nodeConnections=null}else qn._moveNodeConnections({dragData:e})},_moveNodeConnections:({dragData:e})=>{const{diagram:t}=Gn.diagramHandler._env;Gn.nodeConnections.flow.IN.forEach((n=>{t.factory.connection.setEndPoint({connection:n,position:n.endPoint.add(e.distance)})})),Gn.nodeConnections.flow.OUT.forEach((n=>{t.factory.connection.setStartPoint({connection:n,position:n.startPoint.add(e.distance)})})),Gn.nodeConnections.data.OUT.forEach((n=>{t.factory.connection.setStartPoint({connection:n,position:n.startPoint.add(e.distance)})})),Gn.nodeConnections.data.IN.forEach((n=>{t.factory.connection.setEndPoint({connection:n,position:n.endPoint.add(e.distance)})}))},_cleanIntersection:()=>{},_intersectionNodeBody:()=>{const{diagramHandler:e}=Gn,{_env:t}=e,{overObject:n,dragControls:o}=t,r=n.parent,i=o.getObjects();if(null!==t.dragType&&"node"!==t.dragType&&e._cleanIntersection(),i.length>0){if(i[0].uuid===r.uuid)return;i.length=0}o.getObjects().push(r),t.dragType="node",o.transformGroup=!0}},Xn=qn;var Zn=n(768);const Kn={_MODEL:null,init:({model:e})=>{Kn._MODEL=e;const t=new Zn.MeshLineMaterial({useMap:!1,color:new Ye.Color(255),dashRatio:0,opacity:1,sizeAttenuation:!0,lineWidth:.3});Kn._MODEL.flow.material.default=t;const n=new Zn.MeshLineMaterial({useMap:!1,color:new Ye.Color(65535),dashRatio:0,opacity:1,sizeAttenuation:!0,lineWidth:.3});Kn._MODEL.flow.material.selected=n;const o=new Zn.MeshLineMaterial({useMap:!1,color:new Ye.Color(16711680),dashRatio:0,opacity:1,sizeAttenuation:!0,lineWidth:.3});Kn._MODEL.data.material.default=o;const r=new Zn.MeshLineMaterial({useMap:!1,color:new Ye.Color(16776960),dashRatio:0,opacity:1,sizeAttenuation:!0,lineWidth:.3});Kn._MODEL.data.material.selected=r},createConnection:({type:e,startPoint:t,endPoint:n})=>{const o=(new Ye.BufferGeometry).setFromPoints([t,n]);o.dynamic=!0;const r=new Zn.MeshLine;let i;switch(r.setGeometry(o),e){case"flow":i=Kn._MODEL.flow.material.default;break;case"data":i=Kn._MODEL.data.material.default}const a=new Ye.Mesh(r.geometry,i);return a.raycast=Zn.MeshLineRaycast,a.userData={...a.userData,class:"connection",type:e},{type:e,startPoint:t,endPoint:n,meshLine:r,model:a}},setStartPoint:({connection:e,position:t})=>{const{points:n}=e.model.geometry,o=new Ye.Vector3(n[3],n[4],n[5]),r=(new Ye.BufferGeometry).setFromPoints([t,o]);e.meshLine.setGeometry(r),e.startPoint=t},setEndPoint:({connection:e,position:t})=>{const{points:n}=e.model.geometry,o=new Ye.Vector3(n[0],n[1],n[2]),r=(new Ye.BufferGeometry).setFromPoints([o,t]);e.meshLine.setGeometry(r),e.endPoint=t}},Jn=Kn,Qn={flow:{material:{default:null,selected:null}},data:{material:{default:null,selected:null}}},eo={init:()=>{eo.createConnection=Jn.createConnection,eo.setStartPoint=Jn.setStartPoint,eo.setEndPoint=Jn.setEndPoint,Jn.init({model:Qn})},selectConnection:({connection:e})=>{let t;switch(e.type){case"flow":t=Qn.flow.material.selected;break;case"data":t=Qn.data.material.selected}e.model.material=t},unSelectConnection:({connection:e})=>{let t;switch(e.type){case"flow":t=Qn.flow.material.default;break;case"data":t=Qn.data.material.default}e.model.material=t},disposeConnection:({connection:e})=>{e.model.geometry.dispose(),e.meshLine&&e.meshLine.dispose(),e=null}},to=eo,no={model:null,connection:null,type:null,targets:[]},oo={diagramHandler:null,manager:null},ro={_env:oo,init:({diagramHandler:e})=>{const{_env:t}=e;oo.diagramHandler=e,oo.manager=e._env.diagram._env.manager,t.draggableTypes.CONNECTOR="connector",t.selectableTypes.CONNECTION="connection",ro._initHelperConnector()},_initHelperConnector:()=>{const e=new Ye.CylinderGeometry(.7,.7,.3,9),t=new Ye.MeshBasicMaterial({color:16776960}),n=new Ye.Mesh(e,t);no.model=n,no.model.geometry.computeBoundingBox()},_dragConnector:e=>{if(!0===e.dragStart){const{diagramHandler:t}=oo,{_env:n}=t,{overObject:o,diagram:r}=n,{scene:i}=r._env,a=no.model;switch(o.userData.type){case"step_end":no.type="flow",no.targets=r._env.models.connectors.stepSTART;break;case"data_out":no.type="data",no.targets=r._env.models.connectors.dataIN}no.connection=to.createConnection({type:no.type,startPoint:no.model.getWorldPosition(new Ye.Vector3),endPoint:no.model.getWorldPosition(new Ye.Vector3)}),to.setStartPoint({connection:no.connection,position:a.getWorldPosition(new Ye.Vector3)}),to.setEndPoint({connection:no.connection,position:a.getWorldPosition(new Ye.Vector3)}),i.add(no.connection.model),console.log("Drag Connector START",{_drag:e,targets:no.targets})}else if(!0===e.dragEnd){const{diagramHandler:t}=oo,{_env:n}=t,{overObject:o}=n,{manager:r}=n.diagram._env,i=no.model.geometry.boundingBox.clone();let a,s;i.applyMatrix4(no.model.matrixWorld);for(let e=0;e<no.targets.length;e++)if(a=no.targets[e].model,s=a.geometry.boundingBox.clone(),s.applyMatrix4(a.matrixWorld),!0===i.intersectsBox(s)){a.parent.uuid!==o.parent.uuid&&(r.connections.create({type:no.type,source:o.userData.id,target:a.userData.id}),ro._checkConnections({type:no.type,source:o.userData.id,target:a.userData.id}));break}console.log("Drag Connector END",e)}else to.setEndPoint({connection:no.connection,position:no.connection.endPoint.add(e.distance)})},_checkConnections:({type:e,source:t,target:n})=>{if("flow"!==e)return;const{manager:o}=oo;o.connections.getConnections({source:t}).forEach((t=>{t.type===e&&t.target!==n&&o.connections.delete({id:t.id})}))},_intersectionConnector:()=>{const{diagramHandler:e}=oo,{overObject:t,dragControls:n,diagram:o}=e._env,{scene:r}=o._env,i=n.getObjects(),a=no.model;if(null!==e._env.dragType&&"connector"!==e._env.dragType&&e._cleanIntersection(),i.length>0){if(i[0].uuid===a.uuid)return;i.length=0}let s=t.getWorldPosition(new Ye.Vector3);switch(t.userData.type){case"step_end":case"data_out":a.position.set(s.x,-.2,s.z),r.add(a),i.push(a),n.transformGroup=!0,e._env.dragType="connector"}},_intersectionConnection:()=>{const{diagramHandler:e}=oo,{overObject:t,dragControls:n}=e._env,o=n.getObjects();if(o.length>0){if(o[0].uuid===t.uuid)return;o.length=0}o.push(t),n.transformGroup=!1,e._env.dragType="connection"},_dragConnection:e=>{const{diagramHandler:t}=oo,{overObject:n,dragControls:o}=t._env;o.getObjects(),!0===e.dragStart?(o.nonDraggable(),t.selection.select({type:"connection",id:n.userData.id,object:n.userData})):e.dragEnd},_cleanIntersection:()=>{const{diagramHandler:e}=oo,{diagram:t}=e._env,{scene:n}=t._env;n.remove(no.model),null!==no.connection&&(n.remove(no.connection.model),to.disposeConnection({connection:no.connection}),no.connection=null)}},io=ro,ao={diagram:null,diagramHandler:null,selection:{type:null,id:null}},so={_env:ao,init:({diagramHandler:e})=>{ao.diagram=e._env.diagram,ao.diagramHandler=e,e.selection.listenChanges({listener:so._listenerSelectionChanges})},_listenerSelectionChanges:({action:e,payload:t})=>{switch(e){case"select":so._unSelect(),ao.selection=t,so._select();break;case"selectNONE":so._unSelect()}},_select:()=>{const{selection:e,diagram:t}=ao;switch(e.type){case"node":t.factory.node.select({node:t.getNode({id:e.id})});break;case"connection":t.factory.connection.selectConnection({connection:t.getConnection({id:e.id})})}},_unSelect:()=>{const{selection:e,diagram:t}=ao;if(null!==e.type){switch(e.type){case"node":t.factory.node.unSelect({node:t.getNode({id:e.id})});break;case"connection":t.factory.connection.unSelectConnection({connection:t.getConnection({id:e.id})})}ao.selection={type:null,id:null}}}},co=so,lo={diagram:null,dragControls:null,raycaster:null,mouse:null,inViewPort:!1,overObject:null,inDrag:!1,dragged:!1,dragType:null,draggableTypes:{},draggableTypesValues:null,selectableTypes:{},selectableTypesValues:null},uo={_env:lo,init:({diagram:e})=>{const{_env:t}=e,{viewPort:n,camera:o,renderer:r}=t;lo.diagram=e;const i=new Yn([],o,r.domElement);i.transformGroup=!0,lo.dragControls=i;const a=new Ye.Vector2;lo.mouse=a,lo.raycaster=new Ye.Raycaster,Xn.init({diagramHandler:uo}),io.init({diagramHandler:uo}),lo.draggableTypesValues=Object.values(lo.draggableTypes),lo.selectableTypesValues=Object.values(lo.selectableTypes),uo._initDragEvents(),co.init({diagramHandler:uo}),n.addEventListener("mousemove",(e=>{const{left:t,top:o,width:r,height:i}=n.getBoundingClientRect(),s=e.clientX-t,c=e.clientY-o;a.x=s/r*2-1,a.y=1-c/i*2}),!1),n.addEventListener("mouseenter",(e=>{lo.inViewPort=!0}),!1),n.addEventListener("mouseleave",(e=>{lo.inViewPort=!1}),!1),n.addEventListener("click",(e=>{!1===lo.dragged&&me.selectNONE()}),!1)},_initDragEvents:()=>{const{dragControls:e}=lo,t={startPoint:null,endPoint:null,distance:null,dragAction:null,dragStart:!1,dragEnd:!1};e.addEventListener("dragstart",(function(e){switch(t.startPoint=e.object.getWorldPosition(new Ye.Vector3),t.distance=new Ye.Vector3,t.dragStart=!0,lo.inDrag=!0,lo.dragType){case"node":t.dragAction=()=>{Xn._dragNode(t)};break;case"connector":t.dragAction=()=>{io._dragConnector(t)};break;case"connection":t.dragAction=()=>{io._dragConnection(t)}}t.dragAction(t),t.dragStart=!1})),e.addEventListener("drag",(function(e){t.endPoint=e.object.getWorldPosition(new Ye.Vector3),t.distance.subVectors(t.endPoint,t.startPoint),t.dragAction(t),t.startPoint=t.endPoint.clone()})),e.addEventListener("dragend",(function(e){t.dragEnd=!0,t.dragAction(t),lo.inDrag=!1,t.dragAction=null,t.dragEnd=!1,uo._cleanIntersection(),lo.dragged=!0}))},_intersection:()=>{const{mouse:e,diagram:t,raycaster:n}=lo,{camera:o,models:r}=t._env;n.setFromCamera(e,o);const i=n.intersectObjects(r.nodes,!0);if(i.length>0){const e=i[0].object;if(!1===lo.draggableTypesValues.includes(e.userData.class))return void uo._cleanIntersection();switch(lo.overObject=e,e.userData.class){case lo.draggableTypes.NODE_BODY:Xn._intersectionNodeBody();break;case lo.draggableTypes.CONNECTOR:io._intersectionConnector()}return}const a=n.intersectObjects(r.connections,!0);if(a.length>0)return lo.overObject=a[0].object,void io._intersectionConnection();uo._cleanIntersection()},_cleanIntersection:()=>{const{dragControls:e}=lo;e.getObjects().length=0,lo.dragged=!1,lo.dragType=null,lo.overObject=null,Xn._cleanIntersection(),io._cleanIntersection()},handleDiagram:()=>{!0===lo.inViewPort&&!1===lo.inDrag&&uo._intersection()},handlers:{nodes:Xn,connections:io},selection:me},po=uo;class ho extends Ye.Loader{constructor(e){super(e)}load(e,t,n,o){const r=this,i=new Ye.FileLoader(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(r.withCredentials),i.load(e,(function(e){let n;try{n=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}const o=r.parse(n);t&&t(o)}),n,o)}parse(e){return new fo(e)}}class fo{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const n=[],o=function(e,t,n){const o=Array.from(e),r=t/n.resolution,i=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*r,a=[];let s=0,c=0;for(let e=0;e<o.length;e++){const t=o[e];if("\n"===t)s=0,c-=i;else{const e=mo(t,r,s,c,n);s+=e.offsetX,a.push(e.path)}}return a}(e,t,this.data);for(let e=0,t=o.length;e<t;e++)Array.prototype.push.apply(n,o[e].toShapes());return n}}function mo(e,t,n,o,r){const i=r.glyphs[e]||r.glyphs["?"];if(!i)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+r.familyName+".");const a=new Ye.ShapePath;let s,c,l,d,u,p,h,f;if(i.o){const e=i._cachedOutline||(i._cachedOutline=i.o.split(" "));for(let r=0,i=e.length;r<i;)switch(e[r++]){case"m":s=e[r++]*t+n,c=e[r++]*t+o,a.moveTo(s,c);break;case"l":s=e[r++]*t+n,c=e[r++]*t+o,a.lineTo(s,c);break;case"q":l=e[r++]*t+n,d=e[r++]*t+o,u=e[r++]*t+n,p=e[r++]*t+o,a.quadraticCurveTo(u,p,l,d);break;case"b":l=e[r++]*t+n,d=e[r++]*t+o,u=e[r++]*t+n,p=e[r++]*t+o,h=e[r++]*t+n,f=e[r++]*t+o,a.bezierCurveTo(u,p,h,f,l,d)}}return{offsetX:i.ha*t,path:a}}class yo extends Ye.ExtrudeGeometry{constructor(e,t={}){const n=t.font;if(void 0===n)super();else{const o=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),super(o,t)}this.type="TextGeometry"}}const go={material:{default:null}},bo={font:null,fontLoader:null,config:null},vo={_env:bo,init:({config:e})=>(bo.config=e,go.material.default=new Ye.MeshBasicMaterial({color:7829248}),bo.fontLoader=new ho,vo._loadFont()),_loadFont:()=>{const{basePath:e}=bo.config;return new Promise(((t,n)=>{const o=`${e}assets/fonts/Press_Start_2P_Regular.json`;bo.fontLoader.load(o,(function(e){bo.font=e,t({loaded:!0})}))}))},createText:({text:e,size:t,height:n})=>{const o=new yo(e,{size:t,height:n,curveSegments:1,font:bo.font,bevelThickness:1,bevelSize:0,bevelEnabled:!1}),r=new Ye.Mesh(o,go.material.default);return r.geometry.center(),r.rotateX(90*Math.PI/180),{model:r}},dispose:({text:e})=>{e.model.geometry.dispose(),e=null}},_o=vo,wo={head:{geometry:null,material:{default:null}},body:{geometry:null,material:{default:null,selected:null}}},Eo={initialized:!1,builder:null},Co={def:{name:"flow step default",category:"flow",family:"step",type:"default",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}]},_env:Eo,init:({builder:e})=>{!1===Eo.initialized&&(Eo.builder=e,Co.initNodeModel(),Eo.initialized=!0)},initNodeModel:()=>{const{head:e,body:t}=wo,{builder:n}=Eo,o=n.CONSTANTS,{THREE:r}=n._env;e.material.default=new r.MeshBasicMaterial({color:5592405}),e.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,1),t.material.default=new r.MeshBasicMaterial({color:3355443}),t.material.selected=new r.MeshBasicMaterial({color:5596774}),t.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,4)},create:()=>{const{builder:e}=Eo,t=e.CONSTANTS,{THREE:n,TEXT:o}=e._env,r={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},i=new n.Group,a=new n.Mesh(wo.head.geometry,wo.head.material.default);a.position.set(0,0,1.5),a.userData={...a.userData,class:"node-head"},i.add(a);const s=o.createText({text:"some title",size:.25,height:0}).model;s.position.set(0,-.155,1.5),s.userData={...s.userData,class:"text"},i.add(s);const c=new n.Mesh(wo.body.geometry,wo.body.material.default);c.position.set(0,0,-1),c.userData={...c.userData,class:"node-body"},i.add(c);const l=e.createConnector({type:t.CONNECTORS.STEP_START}),d=l.model;d.position.set(-2,-.1,0),i.add(d),r.connector_start=l;const u=e.createConnector({type:t.CONNECTORS.STEP_END}),p=u.model;p.position.set(2,-.1,0),i.add(p),r.connectors_end.push(u);const h=e.createConnector({type:t.CONNECTORS.DATA_IN}),f=h.model;f.rotateZ(90*Math.PI/180),f.position.set(-1,-.1,-3),i.add(f),r.connector_dataIN=h;const m=e.createConnector({type:t.CONNECTORS.DATA_OUT}),y=m.model;return y.rotateZ(-90*Math.PI/180),y.position.set(1,-.1,-3),i.add(y),r.connector_dataOUT=m,i.userData={...i.userData,class:"node",category:"flow",family:"step",type:"default"},r.model=i,r},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=wo.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=wo.body.material.default},dispose:({node:e})=>{}},To={head:{geometry:null,material:{default:null}},body:{shape:null,geometry:null,material:{default:null,selected:null}}},Do={initialized:!1,builder:null},So={def:{name:"data state default",category:"data",family:"state",type:"default",connectors:[{type:"data-in"},{type:"data-out"}]},_env:Do,init:({builder:e})=>{!1===Do.initialized&&(Do.builder=e,So.initNodeModel())},initNodeModel:()=>{const{head:e,body:t}=To,{builder:n}=Do,o=n.CONSTANTS,{THREE:r}=n._env;e.material.default=new r.MeshBasicMaterial({color:5592405}),e.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,1),t.material.default=new r.MeshBasicMaterial({color:3355443}),t.material.selected=new r.MeshBasicMaterial({color:5596774});const i=new r.Shape;i.moveTo(-1.5,2),i.lineTo(1.5,2),i.lineTo(2,1.5),i.lineTo(2,-2),i.lineTo(-2,-2),i.lineTo(-2,1.5),i.lineTo(-1.5,2),t.shape=i,t.geometry=new r.ExtrudeBufferGeometry(t.shape,{amount:o.NODE_HEIGHT,bevelEnabled:!1})},create:({node:e})=>{const{builder:t}=Do,n=t.CONSTANTS,{THREE:o,TEXT:r}=t._env,i={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},a=new o.Group,s=new o.Mesh(To.head.geometry,To.head.material.default);s.position.set(0,0,.5),s.userData={...s.userData,class:"node-head"},a.add(s);const c=e.extra.state.name.substring(0,11),l=r.createText({text:c,size:.25,height:0}).model;l.position.set(0,-.155,.5),l.userData={...l.userData,class:"text"},a.add(l);const d=new o.Mesh(To.body.geometry,To.body.material.default);d.rotateX(90*Math.PI/180),d.position.set(0,.17,0),d.userData={...d.userData,class:"node-body"},a.add(d);const u=t.createConnector({type:n.CONNECTORS.DATA_OUT}),p=u.model;p.rotateZ(90*Math.PI/180),p.position.set(-1,-.1,2),a.add(p),i.connector_dataOUT=u;const h=t.createConnector({type:n.CONNECTORS.DATA_IN}),f=h.model;return f.rotateZ(-90*Math.PI/180),f.position.set(1,-.1,2),a.add(f),i.connector_dataIN=h,a.userData={...a.userData,class:"node",category:"data",family:"state",type:"default"},i.model=a,i},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=To.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=To.body.material.default},dispose:({node:e})=>{}},Ao={body:{geometry:null,material:{default:null,selected:null}},symbol_pause:{geometry_L:null,geometry_R:null,material:{default:null}}},Oo={initialized:!1,builder:null},No={def:{name:"flow step pause",category:"flow",family:"step",type:"pause",connectors:[{type:"step-start"},{type:"step-end"}]},_env:Oo,init:({builder:e})=>{!1===Oo.initialized&&(Oo.builder=e,No.initNodeModel(),Oo.initialized=!0)},initNodeModel:()=>{const{body:e,symbol_pause:t}=Ao,{builder:n}=Oo,o=n.CONSTANTS,{THREE:r}=n._env;e.material.default=new r.MeshBasicMaterial({color:3355443}),e.material.selected=new r.MeshBasicMaterial({color:5596774}),e.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,4),t.material.default=new r.MeshBasicMaterial({color:14347048}),t.geometry_L=new r.BoxBufferGeometry(.2,o.NODE_HEIGHT,1.3),t.geometry_R=new r.BoxBufferGeometry(.2,o.NODE_HEIGHT,1.3)},create:()=>{const{builder:e}=Oo,t=e.CONSTANTS,{THREE:n,TEXT:o}=e._env,r={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},i=new n.Group,a=new n.Mesh(Ao.body.geometry,Ao.body.material.default);a.position.set(0,0,-1),a.userData={...a.userData,class:"node-body"},i.add(a);const s=new n.Mesh(Ao.symbol_pause.geometry_L,Ao.symbol_pause.material.default);s.position.set(-.37,-.1,-1),s.userData={...s.userData,class:"symbol-pause-L"},i.add(s);const c=new n.Mesh(Ao.symbol_pause.geometry_R,Ao.symbol_pause.material.default);c.position.set(.37,-.1,-1),c.userData={...c.userData,class:"symbol-pause-R"},i.add(c);const l=e.createConnector({type:t.CONNECTORS.STEP_START}),d=l.model;d.position.set(-2,-.1,0),i.add(d),r.connector_start=l;const u=e.createConnector({type:t.CONNECTORS.STEP_END}),p=u.model;return p.position.set(2,-.1,0),i.add(p),r.connectors_end.push(u),i.userData={...i.userData,class:"node",category:"flow",family:"step",type:"pause"},r.model=i,r},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=Ao.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=Ao.body.material.default},dispose:({node:e})=>{}},xo={head:{geometry:null,material:{default:null}},body:{shape:null,geometry:null,material:{default:null,selected:null}}},Po={initialized:!1,builder:null},Io={def:{name:"flow step function call",category:"flow",family:"step",type:"function-call",connectors:[{type:"step-start"},{type:"step-end"},{type:"data-in"},{type:"data-out"}]},_env:Po,init:({builder:e})=>{!1===Po.initialized&&(Po.builder=e,Io.initNodeModel(),Po.initialized=!0)},initNodeModel:()=>{const{head:e,body:t}=xo,{builder:n}=Po,o=n.CONSTANTS,{THREE:r}=n._env;e.material.default=new r.MeshBasicMaterial({color:5592405}),e.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,1),t.material.default=new r.MeshBasicMaterial({color:3355443}),t.material.selected=new r.MeshBasicMaterial({color:5596774});const i=new r.Shape;i.moveTo(-1.5,2),i.lineTo(1.5,2),i.lineTo(2.5,4),i.lineTo(1.5,6),i.lineTo(-1.5,6),i.lineTo(-2.5,4),i.lineTo(-1.5,2),t.shape=i,t.geometry=new r.ExtrudeBufferGeometry(t.shape,{amount:o.NODE_HEIGHT,bevelEnabled:!1})},create:()=>{const{builder:e}=Po,t=e.CONSTANTS,{THREE:n,TEXT:o}=e._env,r={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},i=new n.Group,a=new n.Mesh(xo.head.geometry,xo.head.material.default);a.position.set(0,0,1.5),a.userData={...a.userData,class:"node-head"},i.add(a);const s=o.createText({text:"function call",size:.25,height:0}).model;s.position.set(0,-.155,1.5),s.userData={...s.userData,class:"text"},i.add(s);const c=new n.Mesh(xo.body.geometry,xo.body.material.default);c.rotateX(90*Math.PI/180),c.position.set(0,.17,-5),c.userData={...c.userData,class:"node-body"},i.add(c);const l=e.createConnector({type:t.CONNECTORS.STEP_START}),d=l.model;d.position.set(-2,-.1,0),i.add(d),r.connector_start=l;const u=e.createConnector({type:t.CONNECTORS.STEP_END}),p=u.model;p.position.set(2,-.1,0),i.add(p),r.connectors_end.push(u);const h=e.createConnector({type:t.CONNECTORS.DATA_IN}),f=h.model;f.rotateZ(90*Math.PI/180),f.position.set(-1,-.1,-3),i.add(f),r.connector_dataIN=h;const m=e.createConnector({type:t.CONNECTORS.DATA_OUT}),y=m.model;return y.rotateZ(-90*Math.PI/180),y.position.set(1,-.1,-3),i.add(y),r.connector_dataOUT=m,i.userData={...i.userData,class:"node",category:"flow",family:"step",type:"function-call"},r.model=i,r},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=xo.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=xo.body.material.default},dispose:({node:e})=>{}},jo={head:{geometry:null,material:{default:null}},body:{shape:null,geometry:null,material:{default:null,selected:null}}},Lo={initialized:!1,builder:null},Mo={def:{name:"flow signal listen",category:"flow",family:"signal",type:"listen",connectors:[{type:"step-end"}]},_env:Lo,init:({builder:e})=>{!1===Lo.initialized&&(Lo.builder=e,Mo.initNodeModel(),Lo.initialized=!0)},initNodeModel:()=>{const{body:e,head:t}=jo,{builder:n}=Lo,o=n.CONSTANTS,{THREE:r}=n._env;t.material.default=new r.MeshBasicMaterial({color:5592405}),t.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,1),e.material.default=new r.MeshBasicMaterial({color:3355443}),e.material.selected=new r.MeshBasicMaterial({color:5596774});const i=new r.Shape;i.moveTo(-2,2),i.lineTo(2,2),i.lineTo(2,-2),i.lineTo(-2,-2),i.lineTo(-1,0),i.lineTo(-2,2),e.shape=i,e.geometry=new r.ExtrudeBufferGeometry(e.shape,{amount:o.NODE_HEIGHT,bevelEnabled:!1})},create:()=>{const{builder:e}=Lo,t=e.CONSTANTS,{THREE:n,TEXT:o}=e._env,r={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},i=new n.Group,a=new n.Mesh(jo.head.geometry,jo.head.material.default);a.position.set(0,0,1.5),a.userData={...a.userData,class:"node-head"},i.add(a);const s=o.createText({text:"signal",size:.25,height:0}).model;s.position.set(0,-.155,1.5),s.userData={...s.userData,class:"text"},i.add(s);const c=new n.Mesh(jo.body.geometry,jo.body.material.default);c.rotateX(90*Math.PI/180),c.position.set(0,.17,-1),c.userData={...c.userData,class:"node-body"},i.add(c);const l=e.createConnector({type:t.CONNECTORS.STEP_END}),d=l.model;return d.position.set(2,-.1,-1),i.add(d),r.connectors_end.push(l),i.userData={...i.userData,class:"node",category:"flow",family:"signal",type:"listen"},r.model=i,r},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=jo.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=jo.body.material.default},dispose:({node:e})=>{}},ko={head:{geometry:null,material:{default:null}},body:{shape:null,geometry:null,material:{default:null,selected:null}}},Ro={initialized:!1,builder:null},Vo={def:{name:"flow signal emit",category:"flow",family:"signal",type:"emit",connectors:[{type:"step-start"}]},_env:Ro,init:({builder:e})=>{!1===Ro.initialized&&(Ro.builder=e,Vo.initNodeModel(),Ro.initialized=!0)},initNodeModel:()=>{const{body:e,head:t}=ko,{builder:n}=Ro,o=n.CONSTANTS,{THREE:r}=n._env;t.material.default=new r.MeshBasicMaterial({color:5592405}),t.geometry=new r.BoxBufferGeometry(4,o.NODE_HEIGHT,1),e.material.default=new r.MeshBasicMaterial({color:3355443}),e.material.selected=new r.MeshBasicMaterial({color:5596774});const i=new r.Shape;i.moveTo(-2,2),i.lineTo(1,2),i.lineTo(2,0),i.lineTo(1,-2),i.lineTo(-2,-2),i.lineTo(-2,2),e.shape=i,e.geometry=new r.ExtrudeBufferGeometry(e.shape,{amount:o.NODE_HEIGHT,bevelEnabled:!1})},create:()=>{const{builder:e}=Ro,t=e.CONSTANTS,{THREE:n,TEXT:o}=e._env,r={connector_start:null,connectors_end:[],connector_dataIN:null,connector_dataOUT:null,model:null},i=new n.Group,a=new n.Mesh(ko.head.geometry,ko.head.material.default);a.position.set(0,0,1.5),a.userData={...a.userData,class:"node-head"},i.add(a);const s=o.createText({text:"signal",size:.25,height:0}).model;s.position.set(0,-.155,1.5),s.userData={...s.userData,class:"text"},i.add(s);const c=new n.Mesh(ko.body.geometry,ko.body.material.default);c.rotateX(90*Math.PI/180),c.position.set(0,.17,-1),c.userData={...c.userData,class:"node-body"},i.add(c);const l=e.createConnector({type:t.CONNECTORS.STEP_START}),d=l.model;return d.position.set(-2,-.1,-1),i.add(d),r.connector_start=l,i.userData={...i.userData,class:"node",category:"flow",family:"signal",type:"emit"},r.model=i,r},delete:({node:e})=>{},select:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=ko.body.material.selected},unSelect:({node:e})=>{e.model.children.find((e=>"node-body"===e.userData.class)).material=ko.body.material.default},dispose:({node:e})=>{}},Uo={nodesDEFS:{flow_step_default:Co,data_state_default:So,flow_step_pause:No,flow_step_function_call:Io,flow_signal_listen:Mo,flow_signal_emit:Vo},categories:{}},zo={_env:Uo,init:()=>{Object.keys(Uo.nodesDEFS).forEach((e=>{zo.defineNode({nodeDEF:Uo.nodesDEFS[e]})}))},defineNode:({nodeDEF:e})=>{const{category:t,family:n,type:o}=e.def;void 0===Uo.categories[t]&&(Uo.categories[t]={name:t,families:{}});const r=Uo.categories[t];void 0===r.families[n]&&(r.families[n]={name:n,types:{}});const i=r.families[n];if(void 0!==i.types[o])throw new Error("Node type already defined");i.types[o]={name:o,def:e}},getNodeDEF:({category:e,family:t,type:n})=>{const o=Uo.categories[e];if(void 0===o)throw new Error("Category not found.");const r=o.families[t];if(void 0===r)throw new Error("Family not found.");const i=r.types[n];if(void 0===i)throw new Error("Type not found.");return i.def}},Bo=zo,Fo={NODE_HEIGHT:.3,CONNECTORS:{STEP_START:"step_start",STEP_END:"step_end",DATA_IN:"data_in",DATA_OUT:"data_out"}},$o={connector:{geometry:null,material:{default:null},shape:null}},Ho={CONSTANTS:Fo,_env:{THREE:Ye,TEXT:_o},init:()=>{Ho.initNodeModel()},initNodeModel:()=>{const{connector:e}=$o;e.material.default=new Ye.MeshBasicMaterial({color:7829248});const t=new Ye.Shape;t.moveTo(0,.5),t.lineTo(1.5,0),t.lineTo(0,-.5),t.lineTo(0,.5),e.shape=t,e.geometry=new Ye.ExtrudeBufferGeometry(e.shape,{amount:Fo.NODE_HEIGHT,bevelEnabled:!1})},createConnector:({type:e})=>{const t=new Ye.Mesh($o.connector.geometry,$o.connector.material.default);return t.geometry.center(),t.rotateX(90*Math.PI/180),t.userData={...t.userData,class:"connector",type:e},{type:e,model:t}}},Wo=Ho,Yo={init:()=>{Bo.init(),Wo.init()},definitions:Bo,factory:{create:({node:e})=>{const t=Bo.getNodeDEF(e);return t.init({builder:Wo}),t.create({node:e})},select:({node:e})=>{Bo.getNodeDEF(e.model.userData).select({node:e})},unSelect:({node:e})=>{Bo.getNodeDEF(e.model.userData).unSelect({node:e})},dispose:({node:e})=>{Bo.getNodeDEF(e.model.userData).dispose({node:e}),e.model.children.forEach((e=>e.geometry.dispose())),e.model.children.splice(0),e=null}}},Go={manager:null,renderer:null,scene:null,camera:null,orbitControls:null,viewPort:null,nodes:[],connections:[],models:{nodes:[],connections:[],connectors:{stepSTART:[],stepEND:[],dataIN:[],dataOUT:[]}}},qo={_env:Go,init:({manager:e})=>(Go.manager=e,Yo.init(),to.init(),new Promise(((t,n)=>{_o.init({config:e.getConfig()}).then((()=>{t({initialized:!0})}))}))),initScene:({diagramView:e})=>{const{_env:t}=e;if(!0===t.initialized)return;const n=t.myDIV.parentElement,o=t.myDIV.querySelector("div.viewport");Go.viewPort=o;const r=n.clientWidth,i=n.clientHeight,a=new Ye.WebGLRenderer,s=new Ye.Scene,c=new Ye.PerspectiveCamera(75,r/i,.1,1e4);Go.renderer=a,Go.scene=s,Go.camera=c;const l=new Vn(c,a.domElement);l.enableRotate=!1,l.maxDistance=20,l.minDistance=5,Go.orbitControls=l;const d=new Ye.GridHelper(100,100);s.add(d),a.setSize(r,i),o.appendChild(a.domElement);const u=new Ye.AmbientLight(4210752);s.add(u),c.zoom=1,c.lookAt(new Ye.Vector3(0,0,0)),c.position.set(0,-10,0),c.up.set(0,1,0),l.update(),a.render(s,c),po.init({diagram:qo});const p=function(){requestAnimationFrame(p),po.handleDiagram(),a.render(s,c)};p(),new ResizeObserver((e=>{a.setSize(0,0);const t=n.clientWidth,o=n.clientHeight;a.setSize(t,o),c.aspect=t/o,c.updateProjectionMatrix()})).observe(o),t.initialized=!0,console.log("Diagram ENV",Go),console.log("ThreeJS revision",Ye.REVISION)},factory:{node:Yo.factory,connection:to},addNode:({node:e})=>{const{scene:t,nodes:n,models:o}=Go;n.push(e),o.nodes.push(e.model),null!==e.connector_start&&o.connectors.stepSTART.push(e.connector_start),void 0!==e.connectors_end[0]&&o.connectors.stepEND.push(e.connectors_end[0]),null!==e.connector_dataIN&&o.connectors.dataIN.push(e.connector_dataIN),null!==e.connector_dataOUT&&o.connectors.dataOUT.push(e.connector_dataOUT),t.add(e.model)},getNode:({id:e})=>Go.nodes.find((t=>t.id===e)),removeNode:({id:e})=>{const{scene:t,nodes:n,models:o}=Go;let r=qo.getNode({id:e}),i=qo.getConnections({nodeID:e});const a=po.selection.getSelection();"node"===a.type&&a.id===e&&po.selection.selectNONE(),i.connections.forEach((e=>{qo.removeConnection({id:e.id})})),t.remove(r.model);let s=o.nodes.map((e=>e.userData.id)).indexOf(e);o.nodes.splice(s,1),s=o.connectors.stepSTART.indexOf(r.connector_start),s>=0&&o.connectors.stepSTART.splice(s,1),s=o.connectors.stepEND.indexOf(r.connectors_end[0]),s>=0&&o.connectors.stepEND.splice(s,1),s=o.connectors.dataIN.indexOf(r.connector_dataIN),s>=0&&o.connectors.dataIN.splice(s,1),s=o.connectors.dataOUT.indexOf(r.connector_dataOUT),s>=0&&o.connectors.dataOUT.splice(s,1),Yo.factory.dispose({node:r}),s=n.map((e=>e.id)).indexOf(e),n.splice(s,1),Go.renderer.renderLists.dispose()},clearNodes:()=>{Go.nodes.map((e=>e.id)).forEach((e=>qo.removeNode({id:e})))},addConnection:({connection:e})=>{const{scene:t,connections:n,models:o}=Go;n.push(e),o.connections.push(e.model),t.add(e.model)},getConnection:({id:e})=>Go.connections.find((t=>t.id===e)),getConnections:({nodeID:e})=>{const{nodes:t,connections:n,models:o}=Go,r={connections:[],flow:{IN:[],OUT:[]},data:{IN:[],OUT:[]}},i=t.find((t=>t.id===e));return null!==i.connector_start&&(r.flow.IN=n.filter((e=>e.target===i.connector_start.id))),void 0!==i.connectors_end[0]&&(r.flow.OUT=n.filter((e=>e.source===i.connectors_end[0].id))),null!==i.connector_dataIN&&(r.data.IN=n.filter((e=>e.target===i.connector_dataIN.id))),null!==i.connector_dataOUT&&(r.data.OUT=n.filter((e=>e.source===i.connector_dataOUT.id))),r.connections=r.connections.concat(r.flow.IN,r.flow.OUT,r.data.IN,r.data.OUT),r},removeConnection:({id:e})=>{const{scene:t,connections:n,models:o}=Go,r=qo.getConnection({id:e});let i;const a=po.selection.getSelection();"connection"===a.type&&a.id===e&&po.selection.selectNONE(),i=o.connections.map((e=>e.userData.id)).indexOf(e),o.connections.splice(i,1),i=n.map((e=>e.id)).indexOf(e),n.splice(i,1),t.remove(r.model),to.disposeConnection({connection:r})},clearConnections:()=>{Go.connections.map((e=>e.id)).forEach((e=>qo.removeConnection({id:e})))},camera:{getPosition:()=>{const{camera:e}=Go;return{x:e.position.x,y:e.position.y,z:e.position.z}}}},Xo=qo,Zo={myDIV:null},Ko={_env:Zo,init:()=>{Zo.myDIV=document.createElement("article"),Zo.myDIV.classList.add("diagram"),Ke.init({renderer:Xo}),Ko._initRenderer()},_initRenderer:()=>{Xo.init({manager:Ke}).then((e=>{Xo.initScene({diagramView:Ko})}))},getComponent(){const{_env:e}=Ko;return e.myDIV},_render:()=>{const e=Ee.dy`<div class="viewport"></div>`;(0,Ee.sY)(e,Zo.myDIV)},update:()=>{Ko._render()}},Jo=Ko,Qo={openToast:({element:e,delay:t=3e3})=>{e.classList.add("show"),setTimeout((()=>{e.classList.remove("show")}),t)}};function er(e){return e&&"function"==typeof e.schedule}var tr=function(e){return function(t){for(var n=0,o=e.length;n<o&&!t.closed;n++)t.next(e[n]);t.complete()}};function nr(e,t){return new w((function(n){var o=new h,r=0;return o.add(t.schedule((function(){r!==e.length?(n.next(e[r++]),n.closed||o.add(this.schedule())):n.complete()}))),o}))}function or(e,t){return t?nr(e,t):new w(tr(e))}function rr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return er(n)?(e.pop(),nr(e,n)):or(e)}var ir=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ar(e,this.project,this.thisArg))},e}(),ar=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.project=n,r.count=0,r.thisArg=o||r,r}return r(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(y);function sr(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var cr=sr(),lr=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function dr(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var ur=function(e){if(e&&"function"==typeof e[b])return o=e,function(e){var t=o[b]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(lr(e))return tr(e);if(dr(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,c),e};if(e&&"function"==typeof e[cr])return t=e,function(e){for(var n=t[cr]();;){var o=void 0;try{o=n.next()}catch(t){return e.error(t),e}if(o.done){e.complete();break}if(e.next(o.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,o,r=u(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};var pr=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return r(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(y),hr=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(y);function fr(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(o){return o.pipe(fr((function(n,o){return(r=e(n,o),r instanceof w?r:new w(ur(r))).pipe(function(e,t){return function(t){return t.lift(new ir(e,undefined))}}((function(e,r){return t(n,e,o,r)})));var r}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new mr(e,n))})}var mr=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new yr(e,this.project,this.concurrent))},e}(),yr=function(e){function t(t,n,o){void 0===o&&(o=Number.POSITIVE_INFINITY);var r=e.call(this,t)||this;return r.project=n,r.concurrent=o,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return r(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new pr(this),n=this.destination;n.add(t);var o=function(e,t){if(!t.closed)return e instanceof w?e.subscribe(t):ur(e)(t)}(e,t);o!==t&&n.add(o)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(hr);function gr(){return void 0===(e=1)&&(e=Number.POSITIVE_INFINITY),fr(v,e);var e}const br={myDIV:null,state:null,stateRef:null,modalDelete:null},vr={_env:br,init:()=>{br.myDIV=document.createElement("article"),br.myDIV.classList.add("state-editor")},getComponent:()=>br.myDIV,_render:()=>{let{state:e}=br;if(null===e)return;const t=Ee.dy`
      <h2>State editor</h2>
      <div class="State">
        <fieldset data-name="id">
          <legend>ID</legend>
          <input name="id" type="text" .value="${e.id}" autocomplete="off">
          <div class="validation-info"></div>
        </fieldset>
        <fieldset data-name="name">
          <legend>Name</legend>
          <input name="name" type="text" .value="${e.name}" autocomplete="off">
          <div class="validation-info"></div>
        </fieldset>
        <fieldset data-name="description">
          <legend>Description</legend>
          <input name="description" type="text" .value="${e.description}" autocomplete="off">
          <div class="validation-info"></div>
        </fieldset>
        <div class="StateButtons">
          <button @click=${vr._onclickButtonSave}>✔ Save</button>
          <button @click=${vr._onclickButtonDelete}>❌ Delete</button>
          <button @click=${vr._onclickButtonNew}>📄 Create new</button>
        </div>
      </div>
      <fieldset class="Properties">
        <legend>Properties</legend>
        ${vr._renderProperties()}
        <button @click=${vr._onclickButtonAddProp}>➕ Add</button>
      </fieldset>
      <div class="snackbar" data-name="created">State created</div>
      <div class="snackbar" data-name="updated">State updated</div>
      <div class="snackbar" data-name="deleted">State deleted</div>
      ${vr._renderModalDelete()}
    `;(0,Ee.sY)(t,br.myDIV)},_renderProp:({property:e})=>Ee.dy`
      <div class="Property" data-id="${e.id}">
        <input data-type="prop" type="text" .value="${e.id}" autocomplete="off">
        <button @click=${vr._onclickButtonDelProp}>❌ Delete</button>
        <div class="validation-info"></div>
      </div>
    `,_renderProperties:()=>{if(null===br.state)return;const{properties:e}=br.state,t=[];return Object.values(e).forEach((e=>{t.push(vr._renderProp({property:e}))})),t},_renderModalDelete:()=>Ee.dy`
    <!-- The Modal -->
    <div id="modal-delete" class="modal info">
    
      <!-- Modal content -->
      <div class="modal-content">
        <div class="modal-header">
          <span class="close">&times;</span>
          <h2>Delete?</h2>
        </div>
        <div class="modal-body">
          <p>Do you really want to delete this element?</p>
          <p>
            <button type="button" @click="${vr._onButtonConfirmDeleteClick}">Yes</button>
            <button type="button" @click="${()=>br.modalDelete&&br.modalDelete.close()}">No</button>
          </p>
        </div>
        <div class="modal-footer">
          <!-- <h3>Modal Footer</h3> -->
        </div>
      </div>
    
    </div>
    `,update:({params:e=null})=>{null!==e&&(0===Object.keys(e).length?(br.stateRef=null,br.state={id:"",name:"",description:"",properties:{newprop:{id:"newprop",type:null,value:null}}},ve.deSelectState()):(ve.selectState({id:e.id}),br.stateRef=e.id,br.state=J(ve.getState({id:br.stateRef})),vr._clearValidationInfo())),vr._render(),null!==br.stateRef?br.myDIV.querySelector('div.State input[name="id"]').setAttribute("disabled",!0):br.myDIV.querySelector('div.State input[name="id"]').removeAttribute("disabled")},_validateState:({name:e,check:t=null})=>{const{myDIV:n,state:o}=br,r=[],i=n.querySelector(`div.State fieldset[data-name="${e}"] div.validation-info`);i.innerHTML="";const a=n.querySelector(`div.State input[name="${e}"]`).value;let s=null===t||t.test(a);if(!1===s&&r.push("Bad name"),"id"===e&&void 0!==ve.getState({id:a})&&(s=!1,r.push("Duplicated state ID")),"name"===e){const e=Object.values(ve.getStates()).find((e=>e.name===a));void 0!==e&&e.id!==br.stateRef&&(s=!1,r.push("Duplicated state name"))}return!1===s?(r.forEach((e=>{i.innerHTML+=`${e}</br>`})),i.style.display="block"):(i.style.display="none",o[e]=a),s},_validateProperty:({name:e,check:t})=>{const{myDIV:n}=br,{properties:o}=br.state,r=[],i=n.querySelector(`fieldset.Properties div.Property[data-id="${e}"] div.validation-info`);i.innerHTML="";const a=n.querySelector(`fieldset.Properties div.Property[data-id="${e}"] input[data-type="prop"]`).value;let s=t.test(a);!1===s&&r.push("Bad name");const c=Object.keys(o).filter((e=>e===a));return c.length>0&&e!==a?(s=!1,r.push("Name duplicated")):0===c.length&&e!==a&&!1!==s&&(delete o[e],n.querySelector(`fieldset.Properties div.Property[data-id="${e}"]`).setAttribute("data-id",a)),!1===s?(r.forEach((e=>{i.innerHTML+=`${e}</br>`})),i.style.display="block"):(i.style.display="none",o[a]={id:a,type:null,value:null}),s},_clearValidationInfo:()=>{(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return gr()(rr.apply(void 0,e))})(br.myDIV.querySelectorAll("div.State div.validation-info"),br.myDIV.querySelectorAll("fieldset.Properties div.Property div.validation-info")).forEach((e=>{e.innerHTML="",e.style.display="none"}))},_validate:()=>{const{properties:e}=br.state;let t={state:[{name:"id",check:/^[a-z0-9_-]{3,16}$/,result:null},{name:"name",check:/^[a-z0-9_-]{3,16}$/,result:null},{name:"description",result:null}],properties:Object.keys(e).map((e=>({name:e,check:/^[a-z0-9_-]{3,16}$/,result:null})))};return null!==br.stateRef&&t.state.splice(0,1),t.state.forEach((e=>{e.result=vr._validateState(e)})),t.properties.forEach((e=>{e.result=vr._validateProperty(e)})),t.state.some((e=>!1===e.result))||t.properties.some((e=>!1===e.result))},_onclickButtonSave:()=>{!1===vr._validate()&&(null===br.stateRef?(ve.create(J(br.state)),Qo.openToast({element:br.myDIV.querySelector('div.snackbar[data-name="created"]'),delay:1e3}),setTimeout((()=>{I.changeView({urlView:`data/state/${br.state.id}/edit`})}),1e3)):(ve.update(J(br.state)),Qo.openToast({element:br.myDIV.querySelector('div.snackbar[data-name="updated"]'),delay:1e3})))},_onclickButtonDelete:()=>{null!==br.stateRef&&(null===br.modalDelete&&(br.modalDelete=new ut({element:br.myDIV.querySelector("#modal-delete")})),br.modalDelete.open())},_onButtonConfirmDeleteClick:e=>{br.modalDelete.close(),ve.getStateReferences({id:br.stateRef}).forEach((e=>{Ke.nodes.delete({id:e.id})})),ve.deSelectState(),ve.delete({id:br.stateRef}),Qo.openToast({element:br.myDIV.querySelector('div.snackbar[data-name="deleted"]'),delay:1e3}),setTimeout((()=>{I.changeView({urlView:"data/state/new"})}),1e3)},_onclickButtonNew:()=>{I.changeView({urlView:"data/state/new"})},_onclickButtonAddProp:()=>{const{properties:e}=br.state;let t="newprop",n=1;do{t="newprop"+n++}while(void 0!==e[t]);e[t]={id:t,type:null,value:null},vr.update({})},_onclickButtonDelProp:e=>{const t=e.target.parentElement.getAttribute("data-id");delete br.state.properties[t],vr.update({})}},_r={myDIV:null,diagramInfo:null},wr={_env:_r,init:()=>{_r.myDIV=document.createElement("article"),_r.myDIV.classList.add("engine")},getComponent:()=>_r.myDIV,_render:()=>{const e=Ee.dy`
    <h2>Engine</h2>
      ${wr._renderInfoDATA()}
      ${wr._renderInfoExternalProcesses()}
      ${wr._renderInfoSignals()}
    `;(0,Ee.sY)(e,_r.myDIV)},_renderInfoDATA:()=>{const{data:e}=_r.diagramInfo;return Ee.dy`
    <fieldset class="📄 Data">
      <legend>Data</legend>
      ${Object.keys(e).map((e=>wr._renderInfoState({state:e})))}
    </fieldset>
    `},_renderInfoState:({state:e})=>{const t=_r.diagramInfo.data[e];return Ee.dy`
    <fieldset class="State">
      <legend>📄 ${e}</legend>
      <ul>
      ${Object.keys(t).map((e=>Ee.dy`
        <li>${e}</li>
        `))}
      </ul>
    </fieldset>
    `},_renderInfoExternalProcesses:()=>Ee.dy`
    <fieldset class="ExternalProcesses">
      <legend>⚙ External processes</legend>
      <ul>
        ${_r.diagramInfo.process.external.map((e=>Ee.dy`<li>${e}</li>`))}
      </ul>
    </fieldset>
    `,_renderInfoSignals:()=>{const{signals:e}=_r.diagramInfo;return Ee.dy`
    <fieldset class="Signals">
      <legend>Signals</legend>
      <fieldset class="Emit">
        <legend>📡 Emit</legend>
        <ul>
          ${e.emit.map((e=>Ee.dy`<li>${e}</li>`))}
        </ul>
      </fieldset>
      <fieldset class="Listen">
        <legend>▶ Listen</legend>
        <ul>
          ${e.listen.map((e=>Ee.dy`<li>${e}</li>`))}
        </ul>
      </fieldset>
    </fieldset>
    `},_updateDiagramInfo:()=>{Ke.engine.clearEngine(),Ke.engine.diagramProcess.processDiagram(),_r.diagramInfo=Ke.engine.diagramInfo(),console.log("_updateDiagramInfo",{_diagramInfo:_r.diagramInfo})},update:()=>{wr._updateDiagramInfo(),wr._render()}},Er={views:{diagram:Jo,"state-editor":vr,engine:wr}},Cr=()=>{Object.values(Er.views).forEach((e=>{void 0!==e.init&&e.init()}))},Tr=({name:e})=>Er.views[e],Dr={_env:{basePath:null,router:null,container:null},_MESSAGES:{LOCATION_CHANGE:"locationChange"},init:({basePath:e=null,container:t})=>{const{_env:n}=Dr;n.basePath=null!==e?e:N.getConfig().basePath,n.container=t,n.router=new Pn(n.container,{baseUrl:n.basePath}),Cr(),Dr._initRoutes()},_initRoutes:()=>{const{router:e,container:t}=Dr._env;e.setRoutes([{path:"/",redirect:"/diagram"},{path:"/diagram",action:(e,t)=>Dr._changeView({name:"diagram",context:e})},{path:"/data",redirect:"/diagram"},{path:"/data/state",redirect:"/data/state/new"},{path:"/data/state/new",action:(e,t)=>(console.log("/data/state/new",{context:e}),Dr._changeView({name:"state-editor",context:e}))},{path:"/data/state/:id/edit",action:(e,t)=>(console.log("/data/state/:id/edit",{context:e}),Dr._changeView({name:"state-editor",context:e}))},{path:"/engine",action:(e,t)=>Dr._changeView({name:"engine",context:e})}])},_changeView:({name:e,context:t})=>{const{container:n}=Dr._env,o=Tr({name:e});return o.update({params:t.params}),n.innerHTML="",n.appendChild(o.getComponent()),I.notifyLocationChange({title:e,url:t.pathname,id:e,extra:{context:t}}),o.getComponent()}},Sr=Dr;we.init(),xt.init(),xt.render(),Sr.init({container:xt.getLayouts().main.getComponent()})},768:function(e,t,n){(function(){"use strict";this.THREE=n(776);var o=this.THREE;class r extends o.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new o.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(e){this.setGeometry(e,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(e){this.setPoints(e,this.widthCallback)}}})}}function i(e,t){var n=new o.Matrix4,r=new o.Ray,i=new o.Sphere,a=new o.Vector3,s=this.geometry;if(s.boundingSphere||s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(this.matrixWorld),!1!==e.ray.intersectSphere(i,a)){n.copy(this.matrixWorld).invert(),r.copy(e.ray).applyMatrix4(n);var c=new o.Vector3,l=new o.Vector3,d=new o.Vector3,u=this instanceof o.LineSegments?2:1,p=s.index,h=s.attributes;if(null!==p)for(var f=p.array,m=h.position.array,y=h.width.array,g=0,b=f.length-1;g<b;g+=u){var v=f[g],_=f[g+1];c.fromArray(m,3*v),l.fromArray(m,3*_);var w=void 0!==y[Math.floor(g/3)]?y[Math.floor(g/3)]:1,E=e.params.Line.threshold+this.material.lineWidth*w/2,C=E*E;if(!(r.distanceSqToSegment(c,l,a,d)>C)){a.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(a);T<e.near||T>e.far||(t.push({distance:T,point:d.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this}),g=b)}}}}function a(e,t,n,o,r){var i;if(e=e.subarray||e.slice?e:e.buffer,n=n.subarray||n.slice?n:n.buffer,e=t?e.subarray?e.subarray(t,r&&t+r):e.slice(t,r&&t+r):e,n.set)n.set(e,o);else for(i=0;i<e.length;i++)n[i+o]=e[i];return n}r.prototype.setMatrixWorld=function(e){this.matrixWorld=e},r.prototype.setGeometry=function(e,t){this._geometry=e,this.setPoints(e.getAttribute("position").array,t)},r.prototype.setPoints=function(e,t){if(e instanceof Float32Array||e instanceof Array){if(this._points=e,this.widthCallback=t,this.positions=[],this.counters=[],e.length&&e[0]instanceof o.Vector3)for(var n=0;n<e.length;n++){var r=e[n],i=n/e.length;this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(n=0;n<e.length;n+=3)i=n/e.length,this.positions.push(e[n],e[n+1],e[n+2]),this.positions.push(e[n],e[n+1],e[n+2]),this.counters.push(i),this.counters.push(i);this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},r.prototype.raycast=i,r.prototype.compareV3=function(e,t){var n=6*e,o=6*t;return this.positions[n]===this.positions[o]&&this.positions[n+1]===this.positions[o+1]&&this.positions[n+2]===this.positions[o+2]},r.prototype.copyV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},r.prototype.process=function(){var e,t,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(var r=0;r<n;r++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(r/(n-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(r/(n-1),0),this.uvs.push(r/(n-1),1),r<n-1){t=this.copyV3(r),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);var i=2*r;this.indices_array.push(i,i+1,i+2),this.indices_array.push(i+2,i+1,i+3)}r>0&&(t=this.copyV3(r),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new o.BufferAttribute(new Float32Array(this.positions),3),previous:new o.BufferAttribute(new Float32Array(this.previous),3),next:new o.BufferAttribute(new Float32Array(this.next),3),side:new o.BufferAttribute(new Float32Array(this.side),1),width:new o.BufferAttribute(new Float32Array(this.width),1),uv:new o.BufferAttribute(new Float32Array(this.uvs),2),index:new o.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new o.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},r.prototype.advance=function(e){var t=this._attributes.position.array,n=this._attributes.previous.array,o=this._attributes.next.array,r=t.length;a(t,0,n,0,r),a(t,6,t,0,r-6),t[r-6]=e.x,t[r-5]=e.y,t[r-4]=e.z,t[r-3]=e.x,t[r-2]=e.y,t[r-1]=e.z,a(t,6,o,0,r-6),o[r-6]=e.x,o[r-5]=e.y,o[r-4]=e.z,o[r-3]=e.x,o[r-2]=e.y,o[r-1]=e.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},o.ShaderChunk.meshline_vert=["",o.ShaderChunk.logdepthbuf_pars_vertex,o.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",o.ShaderChunk.logdepthbuf_vertex,o.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",o.ShaderChunk.fog_vertex,"}"].join("\n"),o.ShaderChunk.meshline_frag=["",o.ShaderChunk.fog_pars_fragment,o.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",o.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",o.ShaderChunk.fog_fragment,"}"].join("\n");class s extends o.ShaderMaterial{constructor(e){super({uniforms:Object.assign({},o.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new o.Color(16777215)},opacity:{value:1},resolution:{value:new o.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new o.Vector2(1,1)}}),vertexShader:o.ShaderChunk.meshline_vert,fragmentShader:o.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(e){this.uniforms.color.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(e){this.uniforms.dashArray.value=e,this.useDash=0!==e?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(e){this.uniforms.useDash.value=e}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}}s.prototype.copy=function(e){return o.ShaderMaterial.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray.copy(e.dashArray),this.dashOffset.copy(e.dashOffset),this.dashRatio.copy(e.dashRatio),this.useDash=e.useDash,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this},e.exports&&(t=e.exports={MeshLine:r,MeshLineMaterial:s,MeshLineRaycast:i}),t.MeshLine=r,t.MeshLineMaterial=s,t.MeshLineRaycast=i}).call(this)},449:e=>{"use strict";function t(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}e.exports=function(e){return(e=e||{}).circles?function(e){var n=[],o=[];return e.proto?function e(i){if("object"!=typeof i||null===i)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return r(i,e);var a={};for(var s in n.push(i),o.push(a),i){var c=i[s];if("object"!=typeof c||null===c)a[s]=c;else if(c instanceof Date)a[s]=new Date(c);else if(ArrayBuffer.isView(c))a[s]=t(c);else{var l=n.indexOf(c);a[s]=-1!==l?o[l]:e(c)}}return n.pop(),o.pop(),a}:function e(i){if("object"!=typeof i||null===i)return i;if(i instanceof Date)return new Date(i);if(Array.isArray(i))return r(i,e);var a={};for(var s in n.push(i),o.push(a),i)if(!1!==Object.hasOwnProperty.call(i,s)){var c=i[s];if("object"!=typeof c||null===c)a[s]=c;else if(c instanceof Date)a[s]=new Date(c);else if(ArrayBuffer.isView(c))a[s]=t(c);else{var l=n.indexOf(c);a[s]=-1!==l?o[l]:e(c)}}return n.pop(),o.pop(),a};function r(e,r){for(var i=Object.keys(e),a=new Array(i.length),s=0;s<i.length;s++){var c=i[s],l=e[c];if("object"!=typeof l||null===l)a[c]=l;else if(l instanceof Date)a[c]=new Date(l);else if(ArrayBuffer.isView(l))a[c]=t(l);else{var d=n.indexOf(l);a[c]=-1!==d?o[d]:r(l)}}return a}}(e):e.proto?function e(o){if("object"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return n(o,e);var r={};for(var i in o){var a=o[i];"object"!=typeof a||null===a?r[i]=a:a instanceof Date?r[i]=new Date(a):ArrayBuffer.isView(a)?r[i]=t(a):r[i]=e(a)}return r}:function e(o){if("object"!=typeof o||null===o)return o;if(o instanceof Date)return new Date(o);if(Array.isArray(o))return n(o,e);var r={};for(var i in o)if(!1!==Object.hasOwnProperty.call(o,i)){var a=o[i];"object"!=typeof a||null===a?r[i]=a:a instanceof Date?r[i]=new Date(a):ArrayBuffer.isView(a)?r[i]=t(a):r[i]=e(a)}return r};function n(e,n){for(var o=Object.keys(e),r=new Array(o.length),i=0;i<o.length;i++){var a=o[i],s=e[a];"object"!=typeof s||null===s?r[a]=s:s instanceof Date?r[a]=new Date(s):ArrayBuffer.isView(s)?r[a]=t(s):r[a]=n(s)}return r}}}},0,[[574,955,712]]]);